import{Texture as ta,LinearFilter as nn,Color as jt,InstancedBufferGeometry as ra,Sphere as na,Box3 as bn,InstancedBufferAttribute as aa,PlaneGeometry as Ur,Vector2 as kt,Vector4 as an,Matrix3 as oa,Mesh as kr,MeshBasicMaterial as ia,DoubleSide as sa,Matrix4 as la,Vector3 as Sr,DataTexture as fa,RGBAFormat as ua,FloatType as ca,DynamicDrawUsage as ha}from"./three.core.min";function Ln(){var h=Object.create(null);function r(t,e){var a=t.id,o=t.name,n=t.dependencies;n===void 0&&(n=[]);var i=t.init;i===void 0&&(i=function(){});var s=t.getTransferables;if(s===void 0&&(s=null),!h[a])try{n=n.map(function(u){return u&&u.isWorkerModule&&(r(u,function(c){if(c instanceof Error)throw c}),u=h[u.id].value),u}),i=l("<"+o+">.init",i),s&&(s=l("<"+o+">.getTransferables",s));var f=null;typeof i=="function"?f=i.apply(void 0,n):console.error("worker module init function failed to rehydrate"),h[a]={id:a,value:f,getTransferables:s},e(f)}catch(u){u&&u.noLog||console.error(u),e(u)}}function d(t,e){var a,o=t.id,n=t.args;(!h[o]||typeof h[o].value!="function")&&e(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var i=(a=h[o]).value.apply(a,n);i&&typeof i.then=="function"?i.then(s,function(f){return e(f instanceof Error?f:new Error(""+f))}):s(i)}catch(f){e(f)}function s(f){try{var u=h[o].getTransferables&&h[o].getTransferables(f);(!u||!Array.isArray(u)||!u.length)&&(u=void 0),e(f,u)}catch(c){console.error(c),e(c)}}}function l(t,e){var a=void 0;self.troikaDefine=function(n){return a=n};var o=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(o)}catch(n){console.error(n)}return URL.revokeObjectURL(o),delete self.troikaDefine,a}self.addEventListener("message",function(t){var e=t.data,a=e.messageId,o=e.action,n=e.data;try{o==="registerModule"&&r(n,function(i){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof i=="function"}})}),o==="callModule"&&d(n,function(i,s){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:i},s||void 0)})}catch(i){postMessage({messageId:a,success:!1,error:i.stack})}})}function Pn(h){var r=function(){for(var d=[],l=arguments.length;l--;)d[l]=arguments[l];return r._getInitResult().then(function(t){if(typeof t=="function")return t.apply(void 0,d);throw new Error("Worker module function was called but `init` did not return a callable function")})};return r._getInitResult=function(){var d=h.dependencies,l=h.init;d=Array.isArray(d)?d.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var t=Promise.all(d).then(function(e){return l.apply(null,e)});return r._getInitResult=function(){return t},t},r}var Qr=function(){var h=!1;if(typeof window<"u"&&typeof window.document<"u")try{var r=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));r.terminate(),h=!0}catch(d){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+d.message+"]")}return Qr=function(){return h},h},In=0,zn=0,hr=!1,xt=Object.create(null),Tt=Object.create(null),dr=Object.create(null);function $e(h){if((!h||typeof h.init!="function")&&!hr)throw new Error("requires `options.init` function");var r=h.dependencies,d=h.init,l=h.getTransferables,t=h.workerId,e=Pn(h);t==null&&(t="#default");var a="workerModule"+ ++In,o=h.name||a,n=null;r=r&&r.map(function(s){return typeof s=="function"&&!s.workerModuleData&&(hr=!0,s=$e({workerId:t,name:"<"+o+"> function dependency: "+s.name,init:`function(){return (
`+Pt(s)+`
)}`}),hr=!1),s&&s.workerModuleData&&(s=s.workerModuleData),s});function i(){for(var s=[],f=arguments.length;f--;)s[f]=arguments[f];if(!Qr())return e.apply(void 0,s);if(!n){n=Kr(t,"registerModule",i.workerModuleData);var u=function(){n=null,Tt[t].delete(u)};(Tt[t]||(Tt[t]=new Set)).add(u)}return n.then(function(c){var p=c.isCallable;if(p)return Kr(t,"callModule",{id:a,args:s});throw new Error("Worker module function was called but `init` did not return a callable function")})}return i.workerModuleData={isWorkerModule:!0,id:a,name:o,dependencies:r,init:Pt(d),getTransferables:l&&Pt(l)},i.onMainThread=e,i}function Zr(h){Tt[h]&&Tt[h].forEach(function(r){r()}),xt[h]&&(xt[h].terminate(),delete xt[h])}function Pt(h){var r=h.toString();return!/^function/.test(r)&&/^\w+\s*\(/.test(r)&&(r="function "+r),r}function Nn(h){var r=xt[h];if(!r){var d=Pt(Ln);r=xt[h]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+h.replace(/\*/g,"")+` **/

;(`+d+")()"],{type:"application/javascript"}))),r.onmessage=function(l){var t=l.data,e=t.messageId,a=dr[e];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete dr[e],a(t)}}return r}function Kr(h,r,d){return new Promise(function(l,t){var e=++zn;dr[e]=function(a){a.success?l(a.result):t(new Error("Error in worker "+r+" call: "+a.error))},Nn(h).postMessage({messageId:e,action:r,data:d})})}function vr(){var h=function(r){function d(L,E,v,x,U,M,_,z){var C=1-_;z.x=C*C*L+2*C*_*v+_*_*U,z.y=C*C*E+2*C*_*x+_*_*M}function l(L,E,v,x,U,M,_,z,C,P){var X=1-C;P.x=X*X*X*L+3*X*X*C*v+3*X*C*C*U+C*C*C*_,P.y=X*X*X*E+3*X*X*C*x+3*X*C*C*M+C*C*C*z}function t(L,E){for(var v=/([MLQCZ])([^MLQCZ]*)/g,x,U,M,_,z;x=v.exec(L);){var C=x[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(P){return parseFloat(P)});switch(x[1]){case"M":_=U=C[0],z=M=C[1];break;case"L":(C[0]!==_||C[1]!==z)&&E("L",_,z,_=C[0],z=C[1]);break;case"Q":{E("Q",_,z,_=C[2],z=C[3],C[0],C[1]);break}case"C":{E("C",_,z,_=C[4],z=C[5],C[0],C[1],C[2],C[3]);break}case"Z":(_!==U||z!==M)&&E("L",_,z,U,M);break}}}function e(L,E,v){v===void 0&&(v=16);var x={x:0,y:0};t(L,function(U,M,_,z,C,P,X,$,H){switch(U){case"L":E(M,_,z,C);break;case"Q":{for(var W=M,pe=_,ue=1;ue<v;ue++)d(M,_,P,X,z,C,ue/(v-1),x),E(W,pe,x.x,x.y),W=x.x,pe=x.y;break}case"C":{for(var Q=M,ee=_,se=1;se<v;se++)l(M,_,P,X,$,H,z,C,se/(v-1),x),E(Q,ee,x.x,x.y),Q=x.x,ee=x.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",o="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,i={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(L,E){var v=L.getContext?L.getContext("webgl",i):L,x=n.get(v);if(!x){let X=function(Q){var ee=M[Q];if(!ee&&(ee=M[Q]=v.getExtension(Q),!ee))throw new Error(Q+" not supported");return ee},$=function(Q,ee){var se=v.createShader(ee);return v.shaderSource(se,Q),v.compileShader(se),se},H=function(Q,ee,se,j){if(!_[Q]){var te={},q={},G=v.createProgram();v.attachShader(G,$(ee,v.VERTEX_SHADER)),v.attachShader(G,$(se,v.FRAGMENT_SHADER)),v.linkProgram(G),_[Q]={program:G,transaction:function(K){v.useProgram(G),K({setUniform:function(Y,be){for(var re=[],ae=arguments.length-2;ae-- >0;)re[ae]=arguments[ae+2];var fe=q[be]||(q[be]=v.getUniformLocation(G,be));v["uniform"+Y].apply(v,[fe].concat(re))},setAttribute:function(Y,be,re,ae,fe){var de=te[Y];de||(de=te[Y]={buf:v.createBuffer(),loc:v.getAttribLocation(G,Y),data:null}),v.bindBuffer(v.ARRAY_BUFFER,de.buf),v.vertexAttribPointer(de.loc,be,v.FLOAT,!1,0,0),v.enableVertexAttribArray(de.loc),U?v.vertexAttribDivisor(de.loc,ae):X("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(de.loc,ae),fe!==de.data&&(v.bufferData(v.ARRAY_BUFFER,fe,re),de.data=fe)}})}}}_[Q].transaction(j)},W=function(Q,ee){C++;try{v.activeTexture(v.TEXTURE0+C);var se=z[Q];se||(se=z[Q]=v.createTexture(),v.bindTexture(v.TEXTURE_2D,se),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST)),v.bindTexture(v.TEXTURE_2D,se),ee(se,C)}finally{C--}},pe=function(Q,ee,se){var j=v.createFramebuffer();P.push(j),v.bindFramebuffer(v.FRAMEBUFFER,j),v.activeTexture(v.TEXTURE0+ee),v.bindTexture(v.TEXTURE_2D,Q),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,Q,0);try{se(j)}finally{v.deleteFramebuffer(j),v.bindFramebuffer(v.FRAMEBUFFER,P[--P.length-1]||null)}},ue=function(){M={},_={},z={},C=-1,P.length=0};var U=typeof WebGL2RenderingContext<"u"&&v instanceof WebGL2RenderingContext,M={},_={},z={},C=-1,P=[];v.canvas.addEventListener("webglcontextlost",function(Q){ue(),Q.preventDefault()},!1),n.set(v,x={gl:v,isWebGL2:U,getExtension:X,withProgram:H,withTexture:W,withTextureFramebuffer:pe,handleContextLoss:ue})}E(x)}function f(L,E,v,x,U,M,_,z){_===void 0&&(_=15),z===void 0&&(z=null),s(L,function(C){var P=C.gl,X=C.withProgram,$=C.withTexture;$("copy",function(H,W){P.texImage2D(P.TEXTURE_2D,0,P.RGBA,U,M,0,P.RGBA,P.UNSIGNED_BYTE,E),X("copy",a,o,function(pe){var ue=pe.setUniform,Q=pe.setAttribute;Q("aUV",2,P.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ue("1i","image",W),P.bindFramebuffer(P.FRAMEBUFFER,z||null),P.disable(P.BLEND),P.colorMask(_&8,_&4,_&2,_&1),P.viewport(v,x,U,M),P.scissor(v,x,U,M),P.drawArrays(P.TRIANGLES,0,3)})})})}function u(L,E,v){var x=L.width,U=L.height;s(L,function(M){var _=M.gl,z=new Uint8Array(x*U*4);_.readPixels(0,0,x,U,_.RGBA,_.UNSIGNED_BYTE,z),L.width=E,L.height=v,f(_,z,0,0,x,U)})}var c=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:f,resizeWebGLCanvasWithoutClearing:u});function p(L,E,v,x,U,M){M===void 0&&(M=1);var _=new Uint8Array(L*E),z=x[2]-x[0],C=x[3]-x[1],P=[];e(v,function(Q,ee,se,j){P.push({x1:Q,y1:ee,x2:se,y2:j,minX:Math.min(Q,se),minY:Math.min(ee,j),maxX:Math.max(Q,se),maxY:Math.max(ee,j)})}),P.sort(function(Q,ee){return Q.maxX-ee.maxX});for(var X=0;X<L;X++)for(var $=0;$<E;$++){var H=pe(x[0]+z*(X+.5)/L,x[1]+C*($+.5)/E),W=Math.pow(1-Math.abs(H)/U,M)/2;H<0&&(W=1-W),W=Math.max(0,Math.min(255,Math.round(W*255))),_[$*L+X]=W}return _;function pe(Q,ee){for(var se=1/0,j=1/0,te=P.length;te--;){var q=P[te];if(q.maxX+j<=Q)break;if(Q+j>q.minX&&ee-j<q.maxY&&ee+j>q.minY){var G=O(Q,ee,q.x1,q.y1,q.x2,q.y2);G<se&&(se=G,j=Math.sqrt(se))}}return ue(Q,ee)&&(j=-j),j}function ue(Q,ee){for(var se=0,j=P.length;j--;){var te=P[j];if(te.maxX<=Q)break;var q=te.y1>ee!=te.y2>ee&&Q<(te.x2-te.x1)*(ee-te.y1)/(te.y2-te.y1)+te.x1;q&&(se+=te.y1<te.y2?1:-1)}return se!==0}}function g(L,E,v,x,U,M,_,z,C,P){M===void 0&&(M=1),z===void 0&&(z=0),C===void 0&&(C=0),P===void 0&&(P=0),y(L,E,v,x,U,M,_,null,z,C,P)}function y(L,E,v,x,U,M,_,z,C,P,X){M===void 0&&(M=1),C===void 0&&(C=0),P===void 0&&(P=0),X===void 0&&(X=0);for(var $=p(L,E,v,x,U,M),H=new Uint8Array($.length*4),W=0;W<$.length;W++)H[W*4+X]=$[W];f(_,H,C,P,L,E,1<<3-X,z)}function O(L,E,v,x,U,M){var _=U-v,z=M-x,C=_*_+z*z,P=C?Math.max(0,Math.min(1,((L-v)*_+(E-x)*z)/C)):0,X=L-(v+P*_),$=E-(x+P*z);return X*X+$*$}var F=Object.freeze({__proto__:null,generate:p,generateIntoCanvas:g,generateIntoFramebuffer:y}),k="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",T="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",S="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",A=new Float32Array([0,0,2,0,0,2]),b=null,D=!1,N={},B=new WeakMap;function J(L){if(!D&&!V(L))throw new Error("WebGL generation not supported")}function m(L,E,v,x,U,M,_){if(M===void 0&&(M=1),_===void 0&&(_=null),!_&&(_=b,!_)){var z=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!z)throw new Error("OffscreenCanvas or DOM canvas not supported");_=b=z.getContext("webgl",{depth:!1})}J(_);var C=new Uint8Array(L*E*4);s(_,function(H){var W=H.gl,pe=H.withTexture,ue=H.withTextureFramebuffer;pe("readable",function(Q,ee){W.texImage2D(W.TEXTURE_2D,0,W.RGBA,L,E,0,W.RGBA,W.UNSIGNED_BYTE,null),ue(Q,ee,function(se){w(L,E,v,x,U,M,W,se,0,0,0),W.readPixels(0,0,L,E,W.RGBA,W.UNSIGNED_BYTE,C)})})});for(var P=new Uint8Array(L*E),X=0,$=0;X<C.length;X+=4)P[$++]=C[X];return P}function R(L,E,v,x,U,M,_,z,C,P){M===void 0&&(M=1),z===void 0&&(z=0),C===void 0&&(C=0),P===void 0&&(P=0),w(L,E,v,x,U,M,_,null,z,C,P)}function w(L,E,v,x,U,M,_,z,C,P,X){M===void 0&&(M=1),C===void 0&&(C=0),P===void 0&&(P=0),X===void 0&&(X=0),J(_);var $=[];e(v,function(H,W,pe,ue){$.push(H,W,pe,ue)}),$=new Float32Array($),s(_,function(H){var W=H.gl,pe=H.isWebGL2,ue=H.getExtension,Q=H.withProgram,ee=H.withTexture,se=H.withTextureFramebuffer,j=H.handleContextLoss;if(ee("rawDistances",function(te,q){(L!==te._lastWidth||E!==te._lastHeight)&&W.texImage2D(W.TEXTURE_2D,0,W.RGBA,te._lastWidth=L,te._lastHeight=E,0,W.RGBA,W.UNSIGNED_BYTE,null),Q("main",k,T,function(G){var he=G.setAttribute,K=G.setUniform,ne=!pe&&ue("ANGLE_instanced_arrays"),Y=!pe&&ue("EXT_blend_minmax");he("aUV",2,W.STATIC_DRAW,0,A),he("aLineSegment",4,W.DYNAMIC_DRAW,1,$),K.apply(void 0,["4f","uGlyphBounds"].concat(x)),K("1f","uMaxDistance",U),K("1f","uExponent",M),se(te,q,function(be){W.enable(W.BLEND),W.colorMask(!0,!0,!0,!0),W.viewport(0,0,L,E),W.scissor(0,0,L,E),W.blendFunc(W.ONE,W.ONE),W.blendEquationSeparate(W.FUNC_ADD,pe?W.MAX:Y.MAX_EXT),W.clear(W.COLOR_BUFFER_BIT),pe?W.drawArraysInstanced(W.TRIANGLES,0,3,$.length/4):ne.drawArraysInstancedANGLE(W.TRIANGLES,0,3,$.length/4)})}),Q("post",a,S,function(G){G.setAttribute("aUV",2,W.STATIC_DRAW,0,A),G.setUniform("1i","tex",q),W.bindFramebuffer(W.FRAMEBUFFER,z),W.disable(W.BLEND),W.colorMask(X===0,X===1,X===2,X===3),W.viewport(C,P,L,E),W.scissor(C,P,L,E),W.drawArrays(W.TRIANGLES,0,3)})}),W.isContextLost())throw j(),new Error("webgl context lost")})}function V(L){var E=!L||L===b?N:L.canvas||L,v=B.get(E);if(v===void 0){D=!0;var x=null;try{var U=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],M=m(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,L);v=M&&U.length===M.length&&M.every(function(_,z){return _===U[z]}),v||(x="bad trial run results",console.info(U,M))}catch(_){v=!1,x=_.message}x&&console.warn("WebGL SDF generation not supported:",x),D=!1,B.set(E,v)}return v}var I=Object.freeze({__proto__:null,generate:m,generateIntoCanvas:R,generateIntoFramebuffer:w,isSupported:V});function Z(L,E,v,x,U,M){U===void 0&&(U=Math.max(x[2]-x[0],x[3]-x[1])/2),M===void 0&&(M=1);try{return m.apply(I,arguments)}catch(_){return console.info("WebGL SDF generation failed, falling back to JS",_),p.apply(F,arguments)}}function ie(L,E,v,x,U,M,_,z,C,P){U===void 0&&(U=Math.max(x[2]-x[0],x[3]-x[1])/2),M===void 0&&(M=1),z===void 0&&(z=0),C===void 0&&(C=0),P===void 0&&(P=0);try{return R.apply(I,arguments)}catch(X){return console.info("WebGL SDF generation failed, falling back to JS",X),g.apply(F,arguments)}}return r.forEachPathCommand=t,r.generate=Z,r.generateIntoCanvas=ie,r.javascript=F,r.pathToLineSegments=e,r.webgl=I,r.webglUtils=c,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return h}function Wn(){var h=function(r){var d={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},l={},t={};l.L=1,t[1]="L",Object.keys(d).forEach(function(j,te){l[j]=1<<te+1,t[l[j]]=j}),Object.freeze(l);var e=l.LRI|l.RLI|l.FSI,a=l.L|l.R|l.AL,o=l.B|l.S|l.WS|l.ON|l.FSI|l.LRI|l.RLI|l.PDI,n=l.BN|l.RLE|l.LRE|l.RLO|l.LRO|l.PDF,i=l.S|l.WS|l.B|e|l.PDI|n,s=null;function f(){if(!s){s=new Map;var j=function(q){if(d.hasOwnProperty(q)){var G=0;d[q].split(",").forEach(function(he){var K=he.split("+"),ne=K[0],Y=K[1];ne=parseInt(ne,36),Y=Y?parseInt(Y,36):0,s.set(G+=ne,l[q]);for(var be=0;be<Y;be++)s.set(++G,l[q])})}};for(var te in d)j(te)}}function u(j){return f(),s.get(j.codePointAt(0))||l.L}function c(j){return t[u(j)]}var p={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function g(j,te){var q=36,G=0,he=new Map,K=te&&new Map,ne;return j.split(",").forEach(function Y(be){if(be.indexOf("+")!==-1)for(var re=+be;re--;)Y(ne);else{ne=be;var ae=be.split(">"),fe=ae[0],de=ae[1];fe=String.fromCodePoint(G+=parseInt(fe,q)),de=String.fromCodePoint(G+=parseInt(de,q)),he.set(fe,de),te&&K.set(de,fe)}}),{map:he,reverseMap:K}}var y,O,F;function k(){if(!y){var j=g(p.pairs,!0),te=j.map,q=j.reverseMap;y=te,O=q,F=g(p.canonical,!1).map}}function T(j){return k(),y.get(j)||null}function S(j){return k(),O.get(j)||null}function A(j){return k(),F.get(j)||null}var b=l.L,D=l.R,N=l.EN,B=l.ES,J=l.ET,m=l.AN,R=l.CS,w=l.B,V=l.S,I=l.ON,Z=l.BN,ie=l.NSM,L=l.AL,E=l.LRO,v=l.RLO,x=l.LRE,U=l.RLE,M=l.PDF,_=l.LRI,z=l.RLI,C=l.FSI,P=l.PDI;function X(j,te){for(var q=125,G=new Uint32Array(j.length),he=0;he<j.length;he++)G[he]=u(j[he]);var K=new Map;function ne(Ge,Ne){var Le=G[Ge];G[Ge]=Ne,K.set(Le,K.get(Le)-1),Le&o&&K.set(o,K.get(o)-1),K.set(Ne,(K.get(Ne)||0)+1),Ne&o&&K.set(o,(K.get(o)||0)+1)}for(var Y=new Uint8Array(j.length),be=new Map,re=[],ae=null,fe=0;fe<j.length;fe++)ae||re.push(ae={start:fe,end:j.length-1,level:te==="rtl"?1:te==="ltr"?0:Yr(fe,!1)}),G[fe]&w&&(ae.end=fe,ae=null);for(var de=U|x|v|E|e|P|M|w,_e=function(Ge){return Ge+(Ge&1?1:2)},De=function(Ge){return Ge+(Ge&1?2:1)},ge=0;ge<re.length;ge++){ae=re[ge];var me=[{_level:ae.level,_override:0,_isolate:0}],le=void 0,ke=0,Se=0,Oe=0;K.clear();for(var Ue=ae.start;Ue<=ae.end;Ue++){var ce=G[Ue];if(le=me[me.length-1],K.set(ce,(K.get(ce)||0)+1),ce&o&&K.set(o,(K.get(o)||0)+1),ce&de)if(ce&(U|x)){Y[Ue]=le._level;var xe=(ce===U?De:_e)(le._level);xe<=q&&!ke&&!Se?me.push({_level:xe,_override:0,_isolate:0}):ke||Se++}else if(ce&(v|E)){Y[Ue]=le._level;var He=(ce===v?De:_e)(le._level);He<=q&&!ke&&!Se?me.push({_level:He,_override:ce&v?D:b,_isolate:0}):ke||Se++}else if(ce&e){ce&C&&(ce=Yr(Ue+1,!0)===1?z:_),Y[Ue]=le._level,le._override&&ne(Ue,le._override);var Te=(ce===z?De:_e)(le._level);Te<=q&&ke===0&&Se===0?(Oe++,me.push({_level:Te,_override:0,_isolate:1,_isolInitIndex:Ue})):ke++}else if(ce&P){if(ke>0)ke--;else if(Oe>0){for(Se=0;!me[me.length-1]._isolate;)me.pop();var ye=me[me.length-1]._isolInitIndex;ye!=null&&(be.set(ye,Ue),be.set(Ue,ye)),me.pop(),Oe--}le=me[me.length-1],Y[Ue]=le._level,le._override&&ne(Ue,le._override)}else ce&M?(ke===0&&(Se>0?Se--:!le._isolate&&me.length>1&&(me.pop(),le=me[me.length-1])),Y[Ue]=le._level):ce&w&&(Y[Ue]=ae.level);else Y[Ue]=le._level,le._override&&ce!==Z&&ne(Ue,le._override)}for(var Me=[],we=null,ve=ae.start;ve<=ae.end;ve++){var Fe=G[ve];if(!(Fe&n)){var Be=Y[ve],Ee=Fe&e,Ae=Fe===P;we&&Be===we._level?(we._end=ve,we._endsWithIsolInit=Ee):Me.push(we={_start:ve,_end:ve,_level:Be,_startsWithPDI:Ae,_endsWithIsolInit:Ee})}}for(var Ie=[],Xe=0;Xe<Me.length;Xe++){var Ve=Me[Xe];if(!Ve._startsWithPDI||Ve._startsWithPDI&&!be.has(Ve._start)){for(var Ye=[we=Ve],Ze=void 0;we&&we._endsWithIsolInit&&(Ze=be.get(we._end))!=null;)for(var je=Xe+1;je<Me.length;je++)if(Me[je]._start===Ze){Ye.push(we=Me[je]);break}for(var Re=[],qe=0;qe<Ye.length;qe++)for(var Fr=Ye[qe],Xt=Fr._start;Xt<=Fr._end;Xt++)Re.push(Xt);for(var Cn=Y[Re[0]],Dr=ae.level,St=Re[0]-1;St>=0;St--)if(!(G[St]&n)){Dr=Y[St];break}var Yt=Re[Re.length-1],En=Y[Yt],Mr=ae.level;if(!(G[Yt]&e)){for(var wt=Yt+1;wt<=ae.end;wt++)if(!(G[wt]&n)){Mr=Y[wt];break}}Ie.push({_seqIndices:Re,_sosType:Math.max(Dr,Cn)%2?D:b,_eosType:Math.max(Mr,En)%2?D:b})}}for(var Jt=0;Jt<Ie.length;Jt++){var Kt=Ie[Jt],oe=Kt._seqIndices,ut=Kt._sosType,Bn=Kt._eosType,rt=Y[oe[0]]&1?D:b;if(K.get(ie))for(var Ft=0;Ft<oe.length;Ft++){var Ar=oe[Ft];if(G[Ar]&ie){for(var Qt=ut,Dt=Ft-1;Dt>=0;Dt--)if(!(G[oe[Dt]]&n)){Qt=G[oe[Dt]];break}ne(Ar,Qt&(e|P)?I:Qt)}}if(K.get(N))for(var Mt=0;Mt<oe.length;Mt++){var Cr=oe[Mt];if(G[Cr]&N)for(var At=Mt-1;At>=-1;At--){var Er=At===-1?ut:G[oe[At]];if(Er&a){Er===L&&ne(Cr,m);break}}}if(K.get(L))for(var Zt=0;Zt<oe.length;Zt++){var Br=oe[Zt];G[Br]&L&&ne(Br,D)}if(K.get(B)||K.get(R))for(var ct=1;ct<oe.length-1;ct++){var qt=oe[ct];if(G[qt]&(B|R)){for(var nt=0,$t=0,er=ct-1;er>=0&&(nt=G[oe[er]],!!(nt&n));er--);for(var tr=ct+1;tr<oe.length&&($t=G[oe[tr]],!!($t&n));tr++);nt===$t&&(G[qt]===B?nt===N:nt&(N|m))&&ne(qt,nt)}}if(K.get(N))for(var We=0;We<oe.length;We++){var Rn=oe[We];if(G[Rn]&N){for(var Ct=We-1;Ct>=0&&G[oe[Ct]]&(J|n);Ct--)ne(oe[Ct],N);for(We++;We<oe.length&&G[oe[We]]&(J|n|N);We++)G[oe[We]]!==N&&ne(oe[We],N)}}if(K.get(J)||K.get(B)||K.get(R))for(var ht=0;ht<oe.length;ht++){var Rr=oe[ht];if(G[Rr]&(J|B|R)){ne(Rr,I);for(var Et=ht-1;Et>=0&&G[oe[Et]]&n;Et--)ne(oe[Et],I);for(var Bt=ht+1;Bt<oe.length&&G[oe[Bt]]&n;Bt++)ne(oe[Bt],I)}}if(K.get(N))for(var rr=0,Or=ut;rr<oe.length;rr++){var Gr=oe[rr],nr=G[Gr];nr&N?Or===b&&ne(Gr,b):nr&a&&(Or=nr)}if(K.get(o)){var dt=D|N|m,Lr=dt|b,Rt=[];{for(var at=[],ot=0;ot<oe.length;ot++)if(G[oe[ot]]&o){var vt=j[oe[ot]],Pr=void 0;if(T(vt)!==null)if(at.length<63)at.push({char:vt,seqIndex:ot});else break;else if((Pr=S(vt))!==null)for(var pt=at.length-1;pt>=0;pt--){var ar=at[pt].char;if(ar===Pr||ar===S(A(vt))||T(A(ar))===vt){Rt.push([at[pt].seqIndex,ot]),at.length=pt;break}}}Rt.sort(function(Ge,Ne){return Ge[0]-Ne[0]})}for(var or=0;or<Rt.length;or++){for(var Ir=Rt[or],Ot=Ir[0],ir=Ir[1],zr=!1,ze=0,sr=Ot+1;sr<ir;sr++){var Nr=oe[sr];if(G[Nr]&Lr){zr=!0;var Wr=G[Nr]&dt?D:b;if(Wr===rt){ze=Wr;break}}}if(zr&&!ze){ze=ut;for(var lr=Ot-1;lr>=0;lr--){var Vr=oe[lr];if(G[Vr]&Lr){var jr=G[Vr]&dt?D:b;jr!==rt?ze=jr:ze=rt;break}}}if(ze){if(G[oe[Ot]]=G[oe[ir]]=ze,ze!==rt){for(var gt=Ot+1;gt<oe.length;gt++)if(!(G[oe[gt]]&n)){u(j[oe[gt]])&ie&&(G[oe[gt]]=ze);break}}if(ze!==rt){for(var mt=ir+1;mt<oe.length;mt++)if(!(G[oe[mt]]&n)){u(j[oe[mt]])&ie&&(G[oe[mt]]=ze);break}}}}for(var Je=0;Je<oe.length;Je++)if(G[oe[Je]]&o){for(var Hr=Je,fr=Je,ur=ut,yt=Je-1;yt>=0;yt--)if(G[oe[yt]]&n)Hr=yt;else{ur=G[oe[yt]]&dt?D:b;break}for(var Xr=Bn,bt=Je+1;bt<oe.length;bt++)if(G[oe[bt]]&(o|n))fr=bt;else{Xr=G[oe[bt]]&dt?D:b;break}for(var cr=Hr;cr<=fr;cr++)G[oe[cr]]=ur===Xr?ur:rt;Je=fr}}}for(var Pe=ae.start;Pe<=ae.end;Pe++){var On=Y[Pe],Gt=G[Pe];if(On&1?Gt&(b|N|m)&&Y[Pe]++:Gt&D?Y[Pe]++:Gt&(m|N)&&(Y[Pe]+=2),Gt&n&&(Y[Pe]=Pe===0?ae.level:Y[Pe-1]),Pe===ae.end||u(j[Pe])&(V|w))for(var Lt=Pe;Lt>=0&&u(j[Lt])&i;Lt--)Y[Lt]=ae.level}}return{levels:Y,paragraphs:re};function Yr(Ge,Ne){for(var Le=Ge;Le<j.length;Le++){var Ke=G[Le];if(Ke&(D|L))return 1;if(Ke&(w|b)||Ne&&Ke===P)return 0;if(Ke&e){var Jr=Gn(Le);Le=Jr===-1?j.length:Jr}}return 0}function Gn(Ge){for(var Ne=1,Le=Ge+1;Le<j.length;Le++){var Ke=G[Le];if(Ke&w)break;if(Ke&P){if(--Ne===0)return Le}else Ke&e&&Ne++}return-1}}var $="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",H;function W(){if(!H){var j=g($,!0),te=j.map,q=j.reverseMap;q.forEach(function(G,he){te.set(he,G)}),H=te}}function pe(j){return W(),H.get(j)||null}function ue(j,te,q,G){var he=j.length;q=Math.max(0,q==null?0:+q),G=Math.min(he-1,G==null?he-1:+G);for(var K=new Map,ne=q;ne<=G;ne++)if(te[ne]&1){var Y=pe(j[ne]);Y!==null&&K.set(ne,Y)}return K}function Q(j,te,q,G){var he=j.length;q=Math.max(0,q==null?0:+q),G=Math.min(he-1,G==null?he-1:+G);var K=[];return te.paragraphs.forEach(function(ne){var Y=Math.max(q,ne.start),be=Math.min(G,ne.end);if(Y<be){for(var re=te.levels.slice(Y,be+1),ae=be;ae>=Y&&u(j[ae])&i;ae--)re[ae]=ne.level;for(var fe=ne.level,de=1/0,_e=0;_e<re.length;_e++){var De=re[_e];De>fe&&(fe=De),De<de&&(de=De|1)}for(var ge=fe;ge>=de;ge--)for(var me=0;me<re.length;me++)if(re[me]>=ge){for(var le=me;me+1<re.length&&re[me+1]>=ge;)me++;me>le&&K.push([le+Y,me+Y])}}}),K}function ee(j,te,q,G){var he=se(j,te,q,G),K=[].concat(j);return he.forEach(function(ne,Y){K[Y]=(te.levels[ne]&1?pe(j[ne]):null)||j[ne]}),K.join("")}function se(j,te,q,G){for(var he=Q(j,te,q,G),K=[],ne=0;ne<j.length;ne++)K[ne]=ne;return he.forEach(function(Y){for(var be=Y[0],re=Y[1],ae=K.slice(be,re+1),fe=ae.length;fe--;)K[re-fe]=ae[fe]}),K}return r.closingToOpeningBracket=S,r.getBidiCharType=u,r.getBidiCharTypeName=c,r.getCanonicalBracket=A,r.getEmbeddingLevels=X,r.getMirroredCharacter=pe,r.getMirroredCharactersMap=ue,r.getReorderSegments=Q,r.getReorderedIndices=se,r.getReorderedString=ee,r.openingToClosingBracket=T,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return h}var qr=Wn;import{ShaderChunk as Vn,UniformsUtils as jn,MeshDepthMaterial as Hn,RGBADepthPacking as Xn,MeshDistanceMaterial as Yn,ShaderLib as qa,Matrix4 as $a,Vector3 as eo,Mesh as to,CylinderGeometry as ro,Vector2 as no,MeshStandardMaterial as ao,DoubleSide as oo}from"./three.module.min";var gr=/\bvoid\s+main\s*\(\s*\)\s*{/g;function pr(h){let r=/^[ \t]*#include +<([\w\d./]+)>/gm;function d(l,t){let e=Vn[t];return e?pr(e):l}return h.replace(r,d)}var Ce=[];for(let h=0;h<256;h++)Ce[h]=(h<16?"0":"")+h.toString(16);function Jn(){let h=Math.random()*4294967295|0,r=Math.random()*4294967295|0,d=Math.random()*4294967295|0,l=Math.random()*4294967295|0;return(Ce[h&255]+Ce[h>>8&255]+Ce[h>>16&255]+Ce[h>>24&255]+"-"+Ce[r&255]+Ce[r>>8&255]+"-"+Ce[r>>16&15|64]+Ce[r>>24&255]+"-"+Ce[d&63|128]+Ce[d>>8&255]+"-"+Ce[d>>16&255]+Ce[d>>24&255]+Ce[l&255]+Ce[l>>8&255]+Ce[l>>16&255]+Ce[l>>24&255]).toUpperCase()}var et=Object.assign||function(){let h=arguments[0];for(let r=1,d=arguments.length;r<d;r++){let l=arguments[r];if(l)for(let t in l)Object.prototype.hasOwnProperty.call(l,t)&&(h[t]=l[t])}return h},Kn=Date.now(),$r=new WeakMap,en=new Map,Qn=1e10;function it(h,r){let d=ea(r),l=$r.get(h);if(l||$r.set(h,l=Object.create(null)),l[d])return new l[d];let t=`_onBeforeCompile${d}`,e=function(i,s){h.onBeforeCompile.call(this,i,s);let f=this.customProgramCacheKey()+"|"+i.vertexShader+"|"+i.fragmentShader,u=en[f];if(!u){let c=Zn(this,i,r,d);u=en[f]=c}i.vertexShader=u.vertexShader,i.fragmentShader=u.fragmentShader,et(i.uniforms,this.uniforms),r.timeUniform&&(i.uniforms[r.timeUniform]={get value(){return Date.now()-Kn}}),this[t]&&this[t](i)},a=function(){return o(r.chained?h:h.clone())},o=function(i){let s=Object.create(i,n);return Object.defineProperty(s,"baseMaterial",{value:h}),Object.defineProperty(s,"id",{value:Qn++}),s.uuid=Jn(),s.uniforms=et({},i.uniforms,r.uniforms),s.defines=et({},i.defines,r.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${d}`]="",s.extensions=et({},i.extensions,r.extensions),s._listeners=void 0,s},n={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>h.type,set:i=>{h.type=i}},isDerivedFrom:{writable:!0,configurable:!0,value:function(i){let s=this.baseMaterial;return i===s||s.isDerivedMaterial&&s.isDerivedFrom(i)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return h.customProgramCacheKey()+"|"+d}},onBeforeCompile:{get(){return e},set(i){this[t]=i}},copy:{writable:!0,configurable:!0,value:function(i){return h.copy.call(this,i),!h.isShaderMaterial&&!h.isDerivedMaterial&&(et(this.extensions,i.extensions),et(this.defines,i.defines),et(this.uniforms,jn.clone(i.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){let i=new h.constructor;return o(i).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let i=this._depthMaterial;return i||(i=this._depthMaterial=it(h.isDerivedMaterial?h.getDepthMaterial():new Hn({depthPacking:Xn}),r),i.defines.IS_DEPTH_MATERIAL="",i.uniforms=this.uniforms),i}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let i=this._distanceMaterial;return i||(i=this._distanceMaterial=it(h.isDerivedMaterial?h.getDistanceMaterial():new Yn,r),i.defines.IS_DISTANCE_MATERIAL="",i.uniforms=this.uniforms),i}},dispose:{writable:!0,configurable:!0,value(){let{_depthMaterial:i,_distanceMaterial:s}=this;i&&i.dispose(),s&&s.dispose(),h.dispose.call(this)}}};return l[d]=a,new a}function Zn(h,{vertexShader:r,fragmentShader:d},l,t){let{vertexDefs:e,vertexMainIntro:a,vertexMainOutro:o,vertexTransform:n,fragmentDefs:i,fragmentMainIntro:s,fragmentMainOutro:f,fragmentColorTransform:u,customRewriter:c,timeUniform:p}=l;if(e=e||"",a=a||"",o=o||"",i=i||"",s=s||"",f=f||"",(n||c)&&(r=pr(r)),(u||c)&&(d=d.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),d=pr(d)),c){let g=c({vertexShader:r,fragmentShader:d});r=g.vertexShader,d=g.fragmentShader}if(u){let g=[];d=d.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,y=>(g.push(y),"")),f=`${u}
${g.join(`
`)}
${f}`}if(p){let g=`
uniform float ${p};
`;e=g+e,i=g+i}return n&&(r=`vec3 troika_position_${t};
vec3 troika_normal_${t};
vec2 troika_uv_${t};
${r}
`,e=`${e}
void troikaVertexTransform${t}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${n}
}
`,a=`
troika_position_${t} = vec3(position);
troika_normal_${t} = vec3(normal);
troika_uv_${t} = vec2(uv);
troikaVertexTransform${t}(troika_position_${t}, troika_normal_${t}, troika_uv_${t});
${a}
`,r=r.replace(/\b(position|normal|uv)\b/g,(g,y,O,F)=>/\battribute\s+vec[23]\s+$/.test(F.substr(0,O))?y:`troika_${y}_${t}`),h.map&&h.map.channel>0||(r=r.replace(/\bMAP_UV\b/g,`troika_uv_${t}`))),r=tn(r,t,e,a,o),d=tn(d,t,i,s,f),{vertexShader:r,fragmentShader:d}}function tn(h,r,d,l,t){return(l||t||d)&&(h=h.replace(gr,`
${d}
void troikaOrigMain${r}() {`),h+=`
void main() {
  ${l}
  troikaOrigMain${r}();
  ${t}
}`),h}function qn(h,r){return h==="uniforms"?void 0:typeof r=="function"?r.toString():r}var $n=0,rn=new Map;function ea(h){let r=JSON.stringify(h,qn),d=rn.get(r);return d==null&&rn.set(r,d=++$n),d}function da(){return typeof window>"u"&&(self.window=self),function(h){var r={parse:function(t){var e=r._bin,a=new Uint8Array(t);if(e.readASCII(a,0,4)=="ttcf"){var o=4;e.readUshort(a,o),o+=2,e.readUshort(a,o),o+=2;var n=e.readUint(a,o);o+=4;for(var i=[],s=0;s<n;s++){var f=e.readUint(a,o);o+=4,i.push(r._readFont(a,f))}return i}return[r._readFont(a,0)]},_readFont:function(t,e){var a=r._bin,o=e;a.readFixed(t,e),e+=4;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2;for(var i=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:o},f={},u=0;u<n;u++){var c=a.readASCII(t,e,4);e+=4,a.readUint(t,e),e+=4;var p=a.readUint(t,e);e+=4;var g=a.readUint(t,e);e+=4,f[c]={offset:p,length:g}}for(u=0;u<i.length;u++){var y=i[u];f[y]&&(s[y.trim()]=r[y.trim()].parse(t,f[y].offset,f[y].length,s))}return s},_tabOffset:function(t,e,a){for(var o=r._bin,n=o.readUshort(t,a+4),i=a+12,s=0;s<n;s++){var f=o.readASCII(t,i,4);i+=4,o.readUint(t,i),i+=4;var u=o.readUint(t,i);if(i+=4,o.readUint(t,i),i+=4,f==e)return u}return 0}};r._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return r._bin.readShort(t,e)/16384},readInt:function(t,e){return r._bin._view(t).getInt32(e)},readInt8:function(t,e){return r._bin._view(t).getInt8(e)},readShort:function(t,e){return r._bin._view(t).getInt16(e)},readUshort:function(t,e){return r._bin._view(t).getUint16(e)},readUshorts:function(t,e,a){for(var o=[],n=0;n<a;n++)o.push(r._bin.readUshort(t,e+2*n));return o},readUint:function(t,e){return r._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*r._bin.readUint(t,e)+r._bin.readUint(t,e+4)},readASCII:function(t,e,a){for(var o="",n=0;n<a;n++)o+=String.fromCharCode(t[e+n]);return o},readUnicode:function(t,e,a){for(var o="",n=0;n<a;n++){var i=t[e++]<<8|t[e++];o+=String.fromCharCode(i)}return o},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,a){var o=r._bin._tdec;return o&&e==0&&a==t.length?o.decode(t):r._bin.readASCII(t,e,a)},readBytes:function(t,e,a){for(var o=[],n=0;n<a;n++)o.push(t[e+n]);return o},readASCIIArray:function(t,e,a){for(var o=[],n=0;n<a;n++)o.push(String.fromCharCode(t[e+n]));return o},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},r._lctf={},r._lctf.parse=function(t,e,a,o,n){var i=r._bin,s={},f=e;i.readFixed(t,e),e+=4;var u=i.readUshort(t,e);e+=2;var c=i.readUshort(t,e);e+=2;var p=i.readUshort(t,e);return e+=2,s.scriptList=r._lctf.readScriptList(t,f+u),s.featureList=r._lctf.readFeatureList(t,f+c),s.lookupList=r._lctf.readLookupList(t,f+p,n),s},r._lctf.readLookupList=function(t,e,a){var o=r._bin,n=e,i=[],s=o.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var u=o.readUshort(t,e);e+=2;var c=r._lctf.readLookupTable(t,n+u,a);i.push(c)}return i},r._lctf.readLookupTable=function(t,e,a){var o=r._bin,n=e,i={tabs:[]};i.ltype=o.readUshort(t,e),e+=2,i.flag=o.readUshort(t,e),e+=2;var s=o.readUshort(t,e);e+=2;for(var f=i.ltype,u=0;u<s;u++){var c=o.readUshort(t,e);e+=2;var p=a(t,f,n+c,i);i.tabs.push(p)}return i},r._lctf.numOfOnes=function(t){for(var e=0,a=0;a<32;a++)t>>>a&1&&e++;return e},r._lctf.readClassDef=function(t,e){var a=r._bin,o=[],n=a.readUshort(t,e);if(e+=2,n==1){var i=a.readUshort(t,e);e+=2;var s=a.readUshort(t,e);e+=2;for(var f=0;f<s;f++)o.push(i+f),o.push(i+f),o.push(a.readUshort(t,e)),e+=2}if(n==2){var u=a.readUshort(t,e);for(e+=2,f=0;f<u;f++)o.push(a.readUshort(t,e)),e+=2,o.push(a.readUshort(t,e)),e+=2,o.push(a.readUshort(t,e)),e+=2}return o},r._lctf.getInterval=function(t,e){for(var a=0;a<t.length;a+=3){var o=t[a],n=t[a+1];if(t[a+2],o<=e&&e<=n)return a}return-1},r._lctf.readCoverage=function(t,e){var a=r._bin,o={};o.fmt=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,o.fmt==1&&(o.tab=a.readUshorts(t,e,n)),o.fmt==2&&(o.tab=a.readUshorts(t,e,3*n)),o},r._lctf.coverageIndex=function(t,e){var a=t.tab;if(t.fmt==1)return a.indexOf(e);if(t.fmt==2){var o=r._lctf.getInterval(a,e);if(o!=-1)return a[o+2]+(e-a[o])}return-1},r._lctf.readFeatureList=function(t,e){var a=r._bin,o=e,n=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=a.readASCII(t,e,4);e+=4;var u=a.readUshort(t,e);e+=2;var c=r._lctf.readFeatureTable(t,o+u);c.tag=f.trim(),n.push(c)}return n},r._lctf.readFeatureTable=function(t,e){var a=r._bin,o=e,n={},i=a.readUshort(t,e);e+=2,i>0&&(n.featureParams=o+i);var s=a.readUshort(t,e);e+=2,n.tab=[];for(var f=0;f<s;f++)n.tab.push(a.readUshort(t,e+2*f));return n},r._lctf.readScriptList=function(t,e){var a=r._bin,o=e,n={},i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=a.readASCII(t,e,4);e+=4;var u=a.readUshort(t,e);e+=2,n[f.trim()]=r._lctf.readScriptTable(t,o+u)}return n},r._lctf.readScriptTable=function(t,e){var a=r._bin,o=e,n={},i=a.readUshort(t,e);e+=2,i>0&&(n.default=r._lctf.readLangSysTable(t,o+i));var s=a.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var u=a.readASCII(t,e,4);e+=4;var c=a.readUshort(t,e);e+=2,n[u.trim()]=r._lctf.readLangSysTable(t,o+c)}return n},r._lctf.readLangSysTable=function(t,e){var a=r._bin,o={};a.readUshort(t,e),e+=2,o.reqFeature=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,o.features=a.readUshorts(t,e,n),o},r.CFF={},r.CFF.parse=function(t,e,a){var o=r._bin;(t=new Uint8Array(t.buffer,e,a))[e=0],t[++e],t[++e],t[++e],e++;var n=[];e=r.CFF.readIndex(t,e,n);for(var i=[],s=0;s<n.length-1;s++)i.push(o.readASCII(t,e+n[s],n[s+1]-n[s]));e+=n[n.length-1];var f=[];e=r.CFF.readIndex(t,e,f);var u=[];for(s=0;s<f.length-1;s++)u.push(r.CFF.readDict(t,e+f[s],e+f[s+1]));e+=f[f.length-1];var c=u[0],p=[];e=r.CFF.readIndex(t,e,p);var g=[];for(s=0;s<p.length-1;s++)g.push(o.readASCII(t,e+p[s],p[s+1]-p[s]));if(e+=p[p.length-1],r.CFF.readSubrs(t,e,c),c.CharStrings){e=c.CharStrings,p=[],e=r.CFF.readIndex(t,e,p);var y=[];for(s=0;s<p.length-1;s++)y.push(o.readBytes(t,e+p[s],p[s+1]-p[s]));c.CharStrings=y}if(c.ROS){e=c.FDArray;var O=[];for(e=r.CFF.readIndex(t,e,O),c.FDArray=[],s=0;s<O.length-1;s++){var F=r.CFF.readDict(t,e+O[s],e+O[s+1]);r.CFF._readFDict(t,F,g),c.FDArray.push(F)}e+=O[O.length-1],e=c.FDSelect,c.FDSelect=[];var k=t[e];if(e++,k!=3)throw k;var T=o.readUshort(t,e);for(e+=2,s=0;s<T+1;s++)c.FDSelect.push(o.readUshort(t,e),t[e+2]),e+=3}return c.Encoding&&(c.Encoding=r.CFF.readEncoding(t,c.Encoding,c.CharStrings.length)),c.charset&&(c.charset=r.CFF.readCharset(t,c.charset,c.CharStrings.length)),r.CFF._readFDict(t,c,g),c},r.CFF._readFDict=function(t,e,a){var o;for(var n in e.Private&&(o=e.Private[1],e.Private=r.CFF.readDict(t,o,o+e.Private[0]),e.Private.Subrs&&r.CFF.readSubrs(t,o+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(e[n]=a[e[n]-426+35])},r.CFF.readSubrs=function(t,e,a){var o=r._bin,n=[];e=r.CFF.readIndex(t,e,n);var i,s=n.length;i=s<1240?107:s<33900?1131:32768,a.Bias=i,a.Subrs=[];for(var f=0;f<n.length-1;f++)a.Subrs.push(o.readBytes(t,e+n[f],n[f+1]-n[f]))},r.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],r.CFF.glyphByUnicode=function(t,e){for(var a=0;a<t.charset.length;a++)if(t.charset[a]==e)return a;return-1},r.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:r.CFF.glyphByUnicode(t,r.CFF.tableSE[e])},r.CFF.readEncoding=function(t,e,a){r._bin;var o=[".notdef"],n=t[e];if(e++,n!=0)throw"error: unknown encoding format: "+n;var i=t[e];e++;for(var s=0;s<i;s++)o.push(t[e+s]);return o},r.CFF.readCharset=function(t,e,a){var o=r._bin,n=[".notdef"],i=t[e];if(e++,i==0)for(var s=0;s<a;s++){var f=o.readUshort(t,e);e+=2,n.push(f)}else{if(i!=1&&i!=2)throw"error: format: "+i;for(;n.length<a;){f=o.readUshort(t,e),e+=2;var u=0;for(i==1?(u=t[e],e++):(u=o.readUshort(t,e),e+=2),s=0;s<=u;s++)n.push(f),f++}}return n},r.CFF.readIndex=function(t,e,a){var o=r._bin,n=o.readUshort(t,e)+1,i=t[e+=2];if(e++,i==1)for(var s=0;s<n;s++)a.push(t[e+s]);else if(i==2)for(s=0;s<n;s++)a.push(o.readUshort(t,e+2*s));else if(i==3)for(s=0;s<n;s++)a.push(16777215&o.readUint(t,e+3*s-1));else if(n!=1)throw"unsupported offset size: "+i+", count: "+n;return(e+=n*i)-1},r.CFF.getCharString=function(t,e,a){var o=r._bin,n=t[e],i=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,f=null,u=null;n<=20&&(f=n,s=1),n==12&&(f=100*n+i,s=2),21<=n&&n<=27&&(f=n,s=1),n==28&&(u=o.readShort(t,e+1),s=3),29<=n&&n<=31&&(f=n,s=1),32<=n&&n<=246&&(u=n-139,s=1),247<=n&&n<=250&&(u=256*(n-247)+i+108,s=2),251<=n&&n<=254&&(u=256*-(n-251)-i-108,s=2),n==255&&(u=o.readInt(t,e+1)/65535,s=5),a.val=u??"o"+f,a.size=s},r.CFF.readCharString=function(t,e,a){for(var o=e+a,n=r._bin,i=[];e<o;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var u=1,c=null,p=null;s<=20&&(c=s,u=1),s==12&&(c=100*s+f,u=2),s!=19&&s!=20||(c=s,u=2),21<=s&&s<=27&&(c=s,u=1),s==28&&(p=n.readShort(t,e+1),u=3),29<=s&&s<=31&&(c=s,u=1),32<=s&&s<=246&&(p=s-139,u=1),247<=s&&s<=250&&(p=256*(s-247)+f+108,u=2),251<=s&&s<=254&&(p=256*-(s-251)-f-108,u=2),s==255&&(p=n.readInt(t,e+1)/65535,u=5),i.push(p??"o"+c),e+=u}return i},r.CFF.readDict=function(t,e,a){for(var o=r._bin,n={},i=[];e<a;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var u=1,c=null,p=null;if(s==28&&(p=o.readShort(t,e+1),u=3),s==29&&(p=o.readInt(t,e+1),u=5),32<=s&&s<=246&&(p=s-139,u=1),247<=s&&s<=250&&(p=256*(s-247)+f+108,u=2),251<=s&&s<=254&&(p=256*-(s-251)-f-108,u=2),s==255)throw p=o.readInt(t,e+1)/65535,u=5,"unknown number";if(s==30){var g=[];for(u=1;;){var y=t[e+u];u++;var O=y>>4,F=15&y;if(O!=15&&g.push(O),F!=15&&g.push(F),F==15)break}for(var k="",T=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],S=0;S<g.length;S++)k+=T[g[S]];p=parseFloat(k)}s<=21&&(c=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],u=1,s==12&&(c=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][f],u=2)),c!=null?(n[c]=i.length==1?i[0]:i,i=[]):i.push(p),e+=u}return n},r.cmap={},r.cmap.parse=function(t,e,a){t=new Uint8Array(t.buffer,e,a),e=0;var o=r._bin,n={};o.readUshort(t,e),e+=2;var i=o.readUshort(t,e);e+=2;var s=[];n.tables=[];for(var f=0;f<i;f++){var u=o.readUshort(t,e);e+=2;var c=o.readUshort(t,e);e+=2;var p=o.readUint(t,e);e+=4;var g="p"+u+"e"+c,y=s.indexOf(p);if(y==-1){var O;y=n.tables.length,s.push(p);var F=o.readUshort(t,p);F==0?O=r.cmap.parse0(t,p):F==4?O=r.cmap.parse4(t,p):F==6?O=r.cmap.parse6(t,p):F==12?O=r.cmap.parse12(t,p):console.debug("unknown format: "+F,u,c,p),n.tables.push(O)}if(n[g]!=null)throw"multiple tables for one platform+encoding";n[g]=y}return n},r.cmap.parse0=function(t,e){var a=r._bin,o={};o.format=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,o.map=[];for(var i=0;i<n-6;i++)o.map.push(t[e+i]);return o},r.cmap.parse4=function(t,e){var a=r._bin,o=e,n={};n.format=a.readUshort(t,e),e+=2;var i=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2;var s=a.readUshort(t,e);e+=2;var f=s/2;n.searchRange=a.readUshort(t,e),e+=2,n.entrySelector=a.readUshort(t,e),e+=2,n.rangeShift=a.readUshort(t,e),e+=2,n.endCount=a.readUshorts(t,e,f),e+=2*f,e+=2,n.startCount=a.readUshorts(t,e,f),e+=2*f,n.idDelta=[];for(var u=0;u<f;u++)n.idDelta.push(a.readShort(t,e)),e+=2;for(n.idRangeOffset=a.readUshorts(t,e,f),e+=2*f,n.glyphIdArray=[];e<o+i;)n.glyphIdArray.push(a.readUshort(t,e)),e+=2;return n},r.cmap.parse6=function(t,e){var a=r._bin,o={};o.format=a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,o.firstCode=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,o.glyphIdArray=[];for(var i=0;i<n;i++)o.glyphIdArray.push(a.readUshort(t,e)),e+=2;return o},r.cmap.parse12=function(t,e){var a=r._bin,o={};o.format=a.readUshort(t,e),e+=2,e+=2,a.readUint(t,e),e+=4,a.readUint(t,e),e+=4;var n=a.readUint(t,e);e+=4,o.groups=[];for(var i=0;i<n;i++){var s=e+12*i,f=a.readUint(t,s+0),u=a.readUint(t,s+4),c=a.readUint(t,s+8);o.groups.push([f,u,c])}return o},r.glyf={},r.glyf.parse=function(t,e,a,o){for(var n=[],i=0;i<o.maxp.numGlyphs;i++)n.push(null);return n},r.glyf._parseGlyf=function(t,e){var a=r._bin,o=t._data,n=r._tabOffset(o,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var i={};if(i.noc=a.readShort(o,n),n+=2,i.xMin=a.readShort(o,n),n+=2,i.yMin=a.readShort(o,n),n+=2,i.xMax=a.readShort(o,n),n+=2,i.yMax=a.readShort(o,n),n+=2,i.xMin>=i.xMax||i.yMin>=i.yMax)return null;if(i.noc>0){i.endPts=[];for(var s=0;s<i.noc;s++)i.endPts.push(a.readUshort(o,n)),n+=2;var f=a.readUshort(o,n);if(n+=2,o.length-n<f)return null;i.instructions=a.readBytes(o,n,f),n+=f;var u=i.endPts[i.noc-1]+1;for(i.flags=[],s=0;s<u;s++){var c=o[n];if(n++,i.flags.push(c),(8&c)!=0){var p=o[n];n++;for(var g=0;g<p;g++)i.flags.push(c),s++}}for(i.xs=[],s=0;s<u;s++){var y=(2&i.flags[s])!=0,O=(16&i.flags[s])!=0;y?(i.xs.push(O?o[n]:-o[n]),n++):O?i.xs.push(0):(i.xs.push(a.readShort(o,n)),n+=2)}for(i.ys=[],s=0;s<u;s++)y=(4&i.flags[s])!=0,O=(32&i.flags[s])!=0,y?(i.ys.push(O?o[n]:-o[n]),n++):O?i.ys.push(0):(i.ys.push(a.readShort(o,n)),n+=2);var F=0,k=0;for(s=0;s<u;s++)F+=i.xs[s],k+=i.ys[s],i.xs[s]=F,i.ys[s]=k}else{var T;i.parts=[];do{T=a.readUshort(o,n),n+=2;var S={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(i.parts.push(S),S.glyphIndex=a.readUshort(o,n),n+=2,1&T){var A=a.readShort(o,n);n+=2;var b=a.readShort(o,n);n+=2}else A=a.readInt8(o,n),n++,b=a.readInt8(o,n),n++;2&T?(S.m.tx=A,S.m.ty=b):(S.p1=A,S.p2=b),8&T?(S.m.a=S.m.d=a.readF2dot14(o,n),n+=2):64&T?(S.m.a=a.readF2dot14(o,n),n+=2,S.m.d=a.readF2dot14(o,n),n+=2):128&T&&(S.m.a=a.readF2dot14(o,n),n+=2,S.m.b=a.readF2dot14(o,n),n+=2,S.m.c=a.readF2dot14(o,n),n+=2,S.m.d=a.readF2dot14(o,n),n+=2)}while(32&T);if(256&T){var D=a.readUshort(o,n);for(n+=2,i.instr=[],s=0;s<D;s++)i.instr.push(o[n]),n++}}return i},r.GDEF={},r.GDEF.parse=function(t,e,a,o){var n=e;e+=4;var i=r._bin.readUshort(t,e);return{glyphClassDef:i===0?null:r._lctf.readClassDef(t,n+i)}},r.GPOS={},r.GPOS.parse=function(t,e,a,o){return r._lctf.parse(t,e,a,o,r.GPOS.subt)},r.GPOS.subt=function(t,e,a,o){var n=r._bin,i=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var f=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,f+i)}if(e==1&&s.fmt==1){var u=n.readUshort(t,a);a+=2,u!=0&&(s.pos=r.GPOS.readValueRecord(t,a,u))}else if(e==2&&s.fmt>=1&&s.fmt<=2){u=n.readUshort(t,a),a+=2;var c=n.readUshort(t,a);a+=2;var p=r._lctf.numOfOnes(u),g=r._lctf.numOfOnes(c);if(s.fmt==1){s.pairsets=[];var y=n.readUshort(t,a);a+=2;for(var O=0;O<y;O++){var F=i+n.readUshort(t,a);a+=2;var k=n.readUshort(t,F);F+=2;for(var T=[],S=0;S<k;S++){var A=n.readUshort(t,F);F+=2,u!=0&&(m=r.GPOS.readValueRecord(t,F,u),F+=2*p),c!=0&&(R=r.GPOS.readValueRecord(t,F,c),F+=2*g),T.push({gid2:A,val1:m,val2:R})}s.pairsets.push(T)}}if(s.fmt==2){var b=n.readUshort(t,a);a+=2;var D=n.readUshort(t,a);a+=2;var N=n.readUshort(t,a);a+=2;var B=n.readUshort(t,a);for(a+=2,s.classDef1=r._lctf.readClassDef(t,i+b),s.classDef2=r._lctf.readClassDef(t,i+D),s.matrix=[],O=0;O<N;O++){var J=[];for(S=0;S<B;S++){var m=null,R=null;u!=0&&(m=r.GPOS.readValueRecord(t,a,u),a+=2*p),c!=0&&(R=r.GPOS.readValueRecord(t,a,c),a+=2*g),J.push({val1:m,val2:R})}s.matrix.push(J)}}}else if(e==4&&s.fmt==1)s.markCoverage=r._lctf.readCoverage(t,n.readUshort(t,a)+i),s.baseCoverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+i),s.markClassCount=n.readUshort(t,a+4),s.markArray=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+i),s.baseArray=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+i,s.markClassCount);else if(e==6&&s.fmt==1)s.mark1Coverage=r._lctf.readCoverage(t,n.readUshort(t,a)+i),s.mark2Coverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+i),s.markClassCount=n.readUshort(t,a+4),s.mark1Array=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+i),s.mark2Array=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+i,s.markClassCount);else{if(e==9&&s.fmt==1){var w=n.readUshort(t,a);a+=2;var V=n.readUint(t,a);if(a+=4,o.ltype==9)o.ltype=w;else if(o.ltype!=w)throw"invalid extension substitution";return r.GPOS.subt(t,o.ltype,i+V)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},r.GPOS.readValueRecord=function(t,e,a){var o=r._bin,n=[];return n.push(1&a?o.readShort(t,e):0),e+=1&a?2:0,n.push(2&a?o.readShort(t,e):0),e+=2&a?2:0,n.push(4&a?o.readShort(t,e):0),e+=4&a?2:0,n.push(8&a?o.readShort(t,e):0),e+=8&a?2:0,n},r.GPOS.readBaseArray=function(t,e,a){var o=r._bin,n=[],i=e,s=o.readUshort(t,e);e+=2;for(var f=0;f<s;f++){for(var u=[],c=0;c<a;c++)u.push(r.GPOS.readAnchorRecord(t,i+o.readUshort(t,e))),e+=2;n.push(u)}return n},r.GPOS.readMarkArray=function(t,e){var a=r._bin,o=[],n=e,i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=r.GPOS.readAnchorRecord(t,a.readUshort(t,e+2)+n);f.markClass=a.readUshort(t,e),o.push(f),e+=4}return o},r.GPOS.readAnchorRecord=function(t,e){var a=r._bin,o={};return o.fmt=a.readUshort(t,e),o.x=a.readShort(t,e+2),o.y=a.readShort(t,e+4),o},r.GSUB={},r.GSUB.parse=function(t,e,a,o){return r._lctf.parse(t,e,a,o,r.GSUB.subt)},r.GSUB.subt=function(t,e,a,o){var n=r._bin,i=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var f=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,i+f)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(t,a),a+=2;else if(s.fmt==2){var u=n.readUshort(t,a);a+=2,s.newg=n.readUshorts(t,a,u),a+=2*s.newg.length}}else if(e==2&&s.fmt==1){u=n.readUshort(t,a),a+=2,s.seqs=[];for(var c=0;c<u;c++){var p=n.readUshort(t,a)+i;a+=2;var g=n.readUshort(t,p);s.seqs.push(n.readUshorts(t,p+2,g))}}else if(e==4)for(s.vals=[],u=n.readUshort(t,a),a+=2,c=0;c<u;c++){var y=n.readUshort(t,a);a+=2,s.vals.push(r.GSUB.readLigatureSet(t,i+y))}else if(e==5&&s.fmt==2){if(s.fmt==2){var O=n.readUshort(t,a);a+=2,s.cDef=r._lctf.readClassDef(t,i+O),s.scset=[];var F=n.readUshort(t,a);for(a+=2,c=0;c<F;c++){var k=n.readUshort(t,a);a+=2,s.scset.push(k==0?null:r.GSUB.readSubClassSet(t,i+k))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(c=0;c<3;c++){u=n.readUshort(t,a),a+=2;for(var T=[],S=0;S<u;S++)T.push(r._lctf.readCoverage(t,i+n.readUshort(t,a+2*S)));a+=2*u,c==0&&(s.backCvg=T),c==1&&(s.inptCvg=T),c==2&&(s.ahedCvg=T)}u=n.readUshort(t,a),a+=2,s.lookupRec=r.GSUB.readSubstLookupRecords(t,a,u)}}else{if(e==7&&s.fmt==1){var A=n.readUshort(t,a);a+=2;var b=n.readUint(t,a);if(a+=4,o.ltype==9)o.ltype=A;else if(o.ltype!=A)throw"invalid extension substitution";return r.GSUB.subt(t,o.ltype,i+b)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},r.GSUB.readSubClassSet=function(t,e){var a=r._bin.readUshort,o=e,n=[],i=a(t,e);e+=2;for(var s=0;s<i;s++){var f=a(t,e);e+=2,n.push(r.GSUB.readSubClassRule(t,o+f))}return n},r.GSUB.readSubClassRule=function(t,e){var a=r._bin.readUshort,o={},n=a(t,e),i=a(t,e+=2);e+=2,o.input=[];for(var s=0;s<n-1;s++)o.input.push(a(t,e)),e+=2;return o.substLookupRecords=r.GSUB.readSubstLookupRecords(t,e,i),o},r.GSUB.readSubstLookupRecords=function(t,e,a){for(var o=r._bin.readUshort,n=[],i=0;i<a;i++)n.push(o(t,e),o(t,e+2)),e+=4;return n},r.GSUB.readChainSubClassSet=function(t,e){var a=r._bin,o=e,n=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=a.readUshort(t,e);e+=2,n.push(r.GSUB.readChainSubClassRule(t,o+f))}return n},r.GSUB.readChainSubClassRule=function(t,e){for(var a=r._bin,o={},n=["backtrack","input","lookahead"],i=0;i<n.length;i++){var s=a.readUshort(t,e);e+=2,i==1&&s--,o[n[i]]=a.readUshorts(t,e,s),e+=2*o[n[i]].length}return s=a.readUshort(t,e),e+=2,o.subst=a.readUshorts(t,e,2*s),e+=2*o.subst.length,o},r.GSUB.readLigatureSet=function(t,e){var a=r._bin,o=e,n=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=a.readUshort(t,e);e+=2,n.push(r.GSUB.readLigature(t,o+f))}return n},r.GSUB.readLigature=function(t,e){var a=r._bin,o={chain:[]};o.nglyph=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2;for(var i=0;i<n-1;i++)o.chain.push(a.readUshort(t,e)),e+=2;return o},r.head={},r.head.parse=function(t,e,a){var o=r._bin,n={};return o.readFixed(t,e),e+=4,n.fontRevision=o.readFixed(t,e),e+=4,o.readUint(t,e),e+=4,o.readUint(t,e),e+=4,n.flags=o.readUshort(t,e),e+=2,n.unitsPerEm=o.readUshort(t,e),e+=2,n.created=o.readUint64(t,e),e+=8,n.modified=o.readUint64(t,e),e+=8,n.xMin=o.readShort(t,e),e+=2,n.yMin=o.readShort(t,e),e+=2,n.xMax=o.readShort(t,e),e+=2,n.yMax=o.readShort(t,e),e+=2,n.macStyle=o.readUshort(t,e),e+=2,n.lowestRecPPEM=o.readUshort(t,e),e+=2,n.fontDirectionHint=o.readShort(t,e),e+=2,n.indexToLocFormat=o.readShort(t,e),e+=2,n.glyphDataFormat=o.readShort(t,e),e+=2,n},r.hhea={},r.hhea.parse=function(t,e,a){var o=r._bin,n={};return o.readFixed(t,e),e+=4,n.ascender=o.readShort(t,e),e+=2,n.descender=o.readShort(t,e),e+=2,n.lineGap=o.readShort(t,e),e+=2,n.advanceWidthMax=o.readUshort(t,e),e+=2,n.minLeftSideBearing=o.readShort(t,e),e+=2,n.minRightSideBearing=o.readShort(t,e),e+=2,n.xMaxExtent=o.readShort(t,e),e+=2,n.caretSlopeRise=o.readShort(t,e),e+=2,n.caretSlopeRun=o.readShort(t,e),e+=2,n.caretOffset=o.readShort(t,e),e+=2,e+=8,n.metricDataFormat=o.readShort(t,e),e+=2,n.numberOfHMetrics=o.readUshort(t,e),e+=2,n},r.hmtx={},r.hmtx.parse=function(t,e,a,o){for(var n=r._bin,i={aWidth:[],lsBearing:[]},s=0,f=0,u=0;u<o.maxp.numGlyphs;u++)u<o.hhea.numberOfHMetrics&&(s=n.readUshort(t,e),e+=2,f=n.readShort(t,e),e+=2),i.aWidth.push(s),i.lsBearing.push(f);return i},r.kern={},r.kern.parse=function(t,e,a,o){var n=r._bin,i=n.readUshort(t,e);if(e+=2,i==1)return r.kern.parseV1(t,e-2,a,o);var s=n.readUshort(t,e);e+=2;for(var f={glyph1:[],rval:[]},u=0;u<s;u++){e+=2,a=n.readUshort(t,e),e+=2;var c=n.readUshort(t,e);e+=2;var p=c>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;e=r.kern.readFormat0(t,e,f)}return f},r.kern.parseV1=function(t,e,a,o){var n=r._bin;n.readFixed(t,e),e+=4;var i=n.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},f=0;f<i;f++){n.readUint(t,e),e+=4;var u=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2;var c=u>>>8;if((c&=15)!=0)throw"unknown kern table format: "+c;e=r.kern.readFormat0(t,e,s)}return s},r.kern.readFormat0=function(t,e,a){var o=r._bin,n=-1,i=o.readUshort(t,e);e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2;for(var s=0;s<i;s++){var f=o.readUshort(t,e);e+=2;var u=o.readUshort(t,e);e+=2;var c=o.readShort(t,e);e+=2,f!=n&&(a.glyph1.push(f),a.rval.push({glyph2:[],vals:[]}));var p=a.rval[a.rval.length-1];p.glyph2.push(u),p.vals.push(c),n=f}return e},r.loca={},r.loca.parse=function(t,e,a,o){var n=r._bin,i=[],s=o.head.indexToLocFormat,f=o.maxp.numGlyphs+1;if(s==0)for(var u=0;u<f;u++)i.push(n.readUshort(t,e+(u<<1))<<1);if(s==1)for(u=0;u<f;u++)i.push(n.readUint(t,e+(u<<2)));return i},r.maxp={},r.maxp.parse=function(t,e,a){var o=r._bin,n={},i=o.readUint(t,e);return e+=4,n.numGlyphs=o.readUshort(t,e),e+=2,i==65536&&(n.maxPoints=o.readUshort(t,e),e+=2,n.maxContours=o.readUshort(t,e),e+=2,n.maxCompositePoints=o.readUshort(t,e),e+=2,n.maxCompositeContours=o.readUshort(t,e),e+=2,n.maxZones=o.readUshort(t,e),e+=2,n.maxTwilightPoints=o.readUshort(t,e),e+=2,n.maxStorage=o.readUshort(t,e),e+=2,n.maxFunctionDefs=o.readUshort(t,e),e+=2,n.maxInstructionDefs=o.readUshort(t,e),e+=2,n.maxStackElements=o.readUshort(t,e),e+=2,n.maxSizeOfInstructions=o.readUshort(t,e),e+=2,n.maxComponentElements=o.readUshort(t,e),e+=2,n.maxComponentDepth=o.readUshort(t,e),e+=2),n},r.name={},r.name.parse=function(t,e,a){var o=r._bin,n={};o.readUshort(t,e),e+=2;var i=o.readUshort(t,e);e+=2,o.readUshort(t,e);for(var s,f=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],u=e+=2,c=0;c<i;c++){var p=o.readUshort(t,e);e+=2;var g=o.readUshort(t,e);e+=2;var y=o.readUshort(t,e);e+=2;var O=o.readUshort(t,e);e+=2;var F=o.readUshort(t,e);e+=2;var k=o.readUshort(t,e);e+=2;var T,S=f[O],A=u+12*i+k;if(p==0)T=o.readUnicode(t,A,F/2);else if(p==3&&g==0)T=o.readUnicode(t,A,F/2);else if(g==0)T=o.readASCII(t,A,F);else if(g==1)T=o.readUnicode(t,A,F/2);else if(g==3)T=o.readUnicode(t,A,F/2);else{if(p!=1)throw"unknown encoding "+g+", platformID: "+p;T=o.readASCII(t,A,F),console.debug("reading unknown MAC encoding "+g+" as ASCII")}var b="p"+p+","+y.toString(16);n[b]==null&&(n[b]={}),n[b][S!==void 0?S:O]=T,n[b]._lang=y}for(var D in n)if(n[D].postScriptName!=null&&n[D]._lang==1033)return n[D];for(var D in n)if(n[D].postScriptName!=null&&n[D]._lang==0)return n[D];for(var D in n)if(n[D].postScriptName!=null&&n[D]._lang==3084)return n[D];for(var D in n)if(n[D].postScriptName!=null)return n[D];for(var D in n){s=D;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},r["OS/2"]={},r["OS/2"].parse=function(t,e,a){var o=r._bin.readUshort(t,e);e+=2;var n={};if(o==0)r["OS/2"].version0(t,e,n);else if(o==1)r["OS/2"].version1(t,e,n);else if(o==2||o==3||o==4)r["OS/2"].version2(t,e,n);else{if(o!=5)throw"unknown OS/2 table version: "+o;r["OS/2"].version5(t,e,n)}return n},r["OS/2"].version0=function(t,e,a){var o=r._bin;return a.xAvgCharWidth=o.readShort(t,e),e+=2,a.usWeightClass=o.readUshort(t,e),e+=2,a.usWidthClass=o.readUshort(t,e),e+=2,a.fsType=o.readUshort(t,e),e+=2,a.ySubscriptXSize=o.readShort(t,e),e+=2,a.ySubscriptYSize=o.readShort(t,e),e+=2,a.ySubscriptXOffset=o.readShort(t,e),e+=2,a.ySubscriptYOffset=o.readShort(t,e),e+=2,a.ySuperscriptXSize=o.readShort(t,e),e+=2,a.ySuperscriptYSize=o.readShort(t,e),e+=2,a.ySuperscriptXOffset=o.readShort(t,e),e+=2,a.ySuperscriptYOffset=o.readShort(t,e),e+=2,a.yStrikeoutSize=o.readShort(t,e),e+=2,a.yStrikeoutPosition=o.readShort(t,e),e+=2,a.sFamilyClass=o.readShort(t,e),e+=2,a.panose=o.readBytes(t,e,10),e+=10,a.ulUnicodeRange1=o.readUint(t,e),e+=4,a.ulUnicodeRange2=o.readUint(t,e),e+=4,a.ulUnicodeRange3=o.readUint(t,e),e+=4,a.ulUnicodeRange4=o.readUint(t,e),e+=4,a.achVendID=[o.readInt8(t,e),o.readInt8(t,e+1),o.readInt8(t,e+2),o.readInt8(t,e+3)],e+=4,a.fsSelection=o.readUshort(t,e),e+=2,a.usFirstCharIndex=o.readUshort(t,e),e+=2,a.usLastCharIndex=o.readUshort(t,e),e+=2,a.sTypoAscender=o.readShort(t,e),e+=2,a.sTypoDescender=o.readShort(t,e),e+=2,a.sTypoLineGap=o.readShort(t,e),e+=2,a.usWinAscent=o.readUshort(t,e),e+=2,a.usWinDescent=o.readUshort(t,e),e+=2},r["OS/2"].version1=function(t,e,a){var o=r._bin;return e=r["OS/2"].version0(t,e,a),a.ulCodePageRange1=o.readUint(t,e),e+=4,a.ulCodePageRange2=o.readUint(t,e),e+=4},r["OS/2"].version2=function(t,e,a){var o=r._bin;return e=r["OS/2"].version1(t,e,a),a.sxHeight=o.readShort(t,e),e+=2,a.sCapHeight=o.readShort(t,e),e+=2,a.usDefault=o.readUshort(t,e),e+=2,a.usBreak=o.readUshort(t,e),e+=2,a.usMaxContext=o.readUshort(t,e),e+=2},r["OS/2"].version5=function(t,e,a){var o=r._bin;return e=r["OS/2"].version2(t,e,a),a.usLowerOpticalPointSize=o.readUshort(t,e),e+=2,a.usUpperOpticalPointSize=o.readUshort(t,e),e+=2},r.post={},r.post.parse=function(t,e,a){var o=r._bin,n={};return n.version=o.readFixed(t,e),e+=4,n.italicAngle=o.readFixed(t,e),e+=4,n.underlinePosition=o.readShort(t,e),e+=2,n.underlineThickness=o.readShort(t,e),e+=2,n},r==null&&(r={}),r.U==null&&(r.U={}),r.U.codeToGlyph=function(t,e){var a=t.cmap,o=-1;if(a.p0e4!=null?o=a.p0e4:a.p3e1!=null?o=a.p3e1:a.p1e0!=null?o=a.p1e0:a.p0e3!=null&&(o=a.p0e3),o==-1)throw"no familiar platform and encoding!";var n=a.tables[o];if(n.format==0)return e>=n.map.length?0:n.map[e];if(n.format==4){for(var i=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){i=s;break}return i==-1||n.startCount[i]>e?0:65535&(n.idRangeOffset[i]!=0?n.glyphIdArray[e-n.startCount[i]+(n.idRangeOffset[i]>>1)-(n.idRangeOffset.length-i)]:e+n.idDelta[i])}if(n.format==12){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var f=n.groups[s];if(f[0]<=e&&e<=f[1])return f[2]+(e-f[0])}return 0}throw"unknown cmap table format "+n.format},r.U.glyphToPath=function(t,e){var a={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var o=t.SVG.entries[e];return o==null?a:(typeof o=="string"&&(o=r.SVG.toPath(o),t.SVG.entries[e]=o),o)}if(t.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},i=t.CFF,s=t.CFF.Private;if(i.ROS){for(var f=0;i.FDSelect[f+2]<=e;)f+=2;s=i.FDArray[i.FDSelect[f+1]].Private}r.U._drawCFF(t.CFF.CharStrings[e],n,i,s,a)}else t.glyf&&r.U._drawGlyf(e,t,a);return a},r.U._drawGlyf=function(t,e,a){var o=e.glyf[t];o==null&&(o=e.glyf[t]=r.glyf._parseGlyf(e,t)),o!=null&&(o.noc>-1?r.U._simpleGlyph(o,a):r.U._compoGlyph(o,e,a))},r.U._simpleGlyph=function(t,e){for(var a=0;a<t.noc;a++){for(var o=a==0?0:t.endPts[a-1]+1,n=t.endPts[a],i=o;i<=n;i++){var s=i==o?n:i-1,f=i==n?o:i+1,u=1&t.flags[i],c=1&t.flags[s],p=1&t.flags[f],g=t.xs[i],y=t.ys[i];if(i==o)if(u){if(!c){r.U.P.moveTo(e,g,y);continue}r.U.P.moveTo(e,t.xs[s],t.ys[s])}else c?r.U.P.moveTo(e,t.xs[s],t.ys[s]):r.U.P.moveTo(e,(t.xs[s]+g)/2,(t.ys[s]+y)/2);u?c&&r.U.P.lineTo(e,g,y):p?r.U.P.qcurveTo(e,g,y,t.xs[f],t.ys[f]):r.U.P.qcurveTo(e,g,y,(g+t.xs[f])/2,(y+t.ys[f])/2)}r.U.P.closePath(e)}},r.U._compoGlyph=function(t,e,a){for(var o=0;o<t.parts.length;o++){var n={cmds:[],crds:[]},i=t.parts[o];r.U._drawGlyf(i.glyphIndex,e,n);for(var s=i.m,f=0;f<n.crds.length;f+=2){var u=n.crds[f],c=n.crds[f+1];a.crds.push(u*s.a+c*s.b+s.tx),a.crds.push(u*s.c+c*s.d+s.ty)}for(f=0;f<n.cmds.length;f++)a.cmds.push(n.cmds[f])}},r.U._getGlyphClass=function(t,e){var a=r._lctf.getInterval(e,t);return a==-1?0:e[a+2]},r.U._applySubs=function(t,e,a,o){for(var n=t.length-e-1,i=0;i<a.tabs.length;i++)if(a.tabs[i]!=null){var s,f=a.tabs[i];if(!f.coverage||(s=r._lctf.coverageIndex(f.coverage,t[e]))!=-1){if(a.ltype==1)t[e],f.fmt==1?t[e]=t[e]+f.delta:t[e]=f.newg[s];else if(a.ltype==4)for(var u=f.vals[s],c=0;c<u.length;c++){var p=u[c],g=p.chain.length;if(!(g>n)){for(var y=!0,O=0,F=0;F<g;F++){for(;t[e+O+(1+F)]==-1;)O++;p.chain[F]!=t[e+O+(1+F)]&&(y=!1)}if(y){for(t[e]=p.nglyph,F=0;F<g+O;F++)t[e+F+1]=-1;break}}}else if(a.ltype==5&&f.fmt==2)for(var k=r._lctf.getInterval(f.cDef,t[e]),T=f.cDef[k+2],S=f.scset[T],A=0;A<S.length;A++){var b=S[A],D=b.input;if(!(D.length>n)){for(y=!0,F=0;F<D.length;F++){var N=r._lctf.getInterval(f.cDef,t[e+1+F]);if(k==-1&&f.cDef[N+2]!=D[F]){y=!1;break}}if(y){var B=b.substLookupRecords;for(c=0;c<B.length;c+=2)B[c],B[c+1]}}}else if(a.ltype==6&&f.fmt==3){if(!r.U._glsCovered(t,f.backCvg,e-f.backCvg.length)||!r.U._glsCovered(t,f.inptCvg,e)||!r.U._glsCovered(t,f.ahedCvg,e+f.inptCvg.length))continue;var J=f.lookupRec;for(A=0;A<J.length;A+=2){k=J[A];var m=o[J[A+1]];r.U._applySubs(t,e+k,m,o)}}}}},r.U._glsCovered=function(t,e,a){for(var o=0;o<e.length;o++)if(r._lctf.coverageIndex(e[o],t[a+o])==-1)return!1;return!0},r.U.glyphsToPath=function(t,e,a){for(var o={cmds:[],crds:[]},n=0,i=0;i<e.length;i++){var s=e[i];if(s!=-1){for(var f=i<e.length-1&&e[i+1]!=-1?e[i+1]:0,u=r.U.glyphToPath(t,s),c=0;c<u.crds.length;c+=2)o.crds.push(u.crds[c]+n),o.crds.push(u.crds[c+1]);for(a&&o.cmds.push(a),c=0;c<u.cmds.length;c++)o.cmds.push(u.cmds[c]);a&&o.cmds.push("X"),n+=t.hmtx.aWidth[s],i<e.length-1&&(n+=r.U.getPairAdjustment(t,s,f))}}return o},r.U.P={},r.U.P.moveTo=function(t,e,a){t.cmds.push("M"),t.crds.push(e,a)},r.U.P.lineTo=function(t,e,a){t.cmds.push("L"),t.crds.push(e,a)},r.U.P.curveTo=function(t,e,a,o,n,i,s){t.cmds.push("C"),t.crds.push(e,a,o,n,i,s)},r.U.P.qcurveTo=function(t,e,a,o,n){t.cmds.push("Q"),t.crds.push(e,a,o,n)},r.U.P.closePath=function(t){t.cmds.push("Z")},r.U._drawCFF=function(t,e,a,o,n){for(var i=e.stack,s=e.nStems,f=e.haveWidth,u=e.width,c=e.open,p=0,g=e.x,y=e.y,O=0,F=0,k=0,T=0,S=0,A=0,b=0,D=0,N=0,B=0,J={val:0,size:0};p<t.length;){r.CFF.getCharString(t,p,J);var m=J.val;if(p+=J.size,m=="o1"||m=="o18")i.length%2!=0&&!f&&(u=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,f=!0;else if(m=="o3"||m=="o23")i.length%2!=0&&!f&&(u=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,f=!0;else if(m=="o4")i.length>1&&!f&&(u=i.shift()+o.nominalWidthX,f=!0),c&&r.U.P.closePath(n),y+=i.pop(),r.U.P.moveTo(n,g,y),c=!0;else if(m=="o5")for(;i.length>0;)g+=i.shift(),y+=i.shift(),r.U.P.lineTo(n,g,y);else if(m=="o6"||m=="o7")for(var R=i.length,w=m=="o6",V=0;V<R;V++){var I=i.shift();w?g+=I:y+=I,w=!w,r.U.P.lineTo(n,g,y)}else if(m=="o8"||m=="o24"){R=i.length;for(var Z=0;Z+6<=R;)O=g+i.shift(),F=y+i.shift(),k=O+i.shift(),T=F+i.shift(),g=k+i.shift(),y=T+i.shift(),r.U.P.curveTo(n,O,F,k,T,g,y),Z+=6;m=="o24"&&(g+=i.shift(),y+=i.shift(),r.U.P.lineTo(n,g,y))}else{if(m=="o11")break;if(m=="o1234"||m=="o1235"||m=="o1236"||m=="o1237")m=="o1234"&&(F=y,k=(O=g+i.shift())+i.shift(),B=T=F+i.shift(),A=T,D=y,g=(b=(S=(N=k+i.shift())+i.shift())+i.shift())+i.shift(),r.U.P.curveTo(n,O,F,k,T,N,B),r.U.P.curveTo(n,S,A,b,D,g,y)),m=="o1235"&&(O=g+i.shift(),F=y+i.shift(),k=O+i.shift(),T=F+i.shift(),N=k+i.shift(),B=T+i.shift(),S=N+i.shift(),A=B+i.shift(),b=S+i.shift(),D=A+i.shift(),g=b+i.shift(),y=D+i.shift(),i.shift(),r.U.P.curveTo(n,O,F,k,T,N,B),r.U.P.curveTo(n,S,A,b,D,g,y)),m=="o1236"&&(O=g+i.shift(),F=y+i.shift(),k=O+i.shift(),B=T=F+i.shift(),A=T,b=(S=(N=k+i.shift())+i.shift())+i.shift(),D=A+i.shift(),g=b+i.shift(),r.U.P.curveTo(n,O,F,k,T,N,B),r.U.P.curveTo(n,S,A,b,D,g,y)),m=="o1237"&&(O=g+i.shift(),F=y+i.shift(),k=O+i.shift(),T=F+i.shift(),N=k+i.shift(),B=T+i.shift(),S=N+i.shift(),A=B+i.shift(),b=S+i.shift(),D=A+i.shift(),Math.abs(b-g)>Math.abs(D-y)?g=b+i.shift():y=D+i.shift(),r.U.P.curveTo(n,O,F,k,T,N,B),r.U.P.curveTo(n,S,A,b,D,g,y));else if(m=="o14"){if(i.length>0&&!f&&(u=i.shift()+a.nominalWidthX,f=!0),i.length==4){var ie=i.shift(),L=i.shift(),E=i.shift(),v=i.shift(),x=r.CFF.glyphBySE(a,E),U=r.CFF.glyphBySE(a,v);r.U._drawCFF(a.CharStrings[x],e,a,o,n),e.x=ie,e.y=L,r.U._drawCFF(a.CharStrings[U],e,a,o,n)}c&&(r.U.P.closePath(n),c=!1)}else if(m=="o19"||m=="o20")i.length%2!=0&&!f&&(u=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,f=!0,p+=s+7>>3;else if(m=="o21")i.length>2&&!f&&(u=i.shift()+o.nominalWidthX,f=!0),y+=i.pop(),g+=i.pop(),c&&r.U.P.closePath(n),r.U.P.moveTo(n,g,y),c=!0;else if(m=="o22")i.length>1&&!f&&(u=i.shift()+o.nominalWidthX,f=!0),g+=i.pop(),c&&r.U.P.closePath(n),r.U.P.moveTo(n,g,y),c=!0;else if(m=="o25"){for(;i.length>6;)g+=i.shift(),y+=i.shift(),r.U.P.lineTo(n,g,y);O=g+i.shift(),F=y+i.shift(),k=O+i.shift(),T=F+i.shift(),g=k+i.shift(),y=T+i.shift(),r.U.P.curveTo(n,O,F,k,T,g,y)}else if(m=="o26")for(i.length%2&&(g+=i.shift());i.length>0;)O=g,F=y+i.shift(),g=k=O+i.shift(),y=(T=F+i.shift())+i.shift(),r.U.P.curveTo(n,O,F,k,T,g,y);else if(m=="o27")for(i.length%2&&(y+=i.shift());i.length>0;)F=y,k=(O=g+i.shift())+i.shift(),T=F+i.shift(),g=k+i.shift(),y=T,r.U.P.curveTo(n,O,F,k,T,g,y);else if(m=="o10"||m=="o29"){var M=m=="o10"?o:a;if(i.length==0)console.debug("error: empty stack");else{var _=i.pop(),z=M.Subrs[_+M.Bias];e.x=g,e.y=y,e.nStems=s,e.haveWidth=f,e.width=u,e.open=c,r.U._drawCFF(z,e,a,o,n),g=e.x,y=e.y,s=e.nStems,f=e.haveWidth,u=e.width,c=e.open}}else if(m=="o30"||m=="o31"){var C=i.length,P=(Z=0,m=="o31");for(Z+=C-(R=-3&C);Z<R;)P?(F=y,k=(O=g+i.shift())+i.shift(),y=(T=F+i.shift())+i.shift(),R-Z==5?(g=k+i.shift(),Z++):g=k,P=!1):(O=g,F=y+i.shift(),k=O+i.shift(),T=F+i.shift(),g=k+i.shift(),R-Z==5?(y=T+i.shift(),Z++):y=T,P=!0),r.U.P.curveTo(n,O,F,k,T,g,y),Z+=4}else{if((m+"").charAt(0)=="o")throw console.debug("Unknown operation: "+m,t),m;i.push(m)}}}e.x=g,e.y=y,e.nStems=s,e.haveWidth=f,e.width=u,e.open=c};var d=r,l={Typr:d};return h.Typr=d,h.default=l,Object.defineProperty(h,"__esModule",{value:!0}),h}({}).Typr}function va(){return function(h){var r=Uint8Array,d=Uint16Array,l=Uint32Array,t=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(m,R){for(var w=new d(31),V=0;V<31;++V)w[V]=R+=1<<m[V-1];var I=new l(w[30]);for(V=1;V<30;++V)for(var Z=w[V];Z<w[V+1];++Z)I[Z]=Z-w[V]<<5|V;return[w,I]},n=o(t,2),i=n[0],s=n[1];i[28]=258,s[258]=28;for(var f=o(e,0)[0],u=new d(32768),c=0;c<32768;++c){var p=(43690&c)>>>1|(21845&c)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,u[c]=((65280&p)>>>8|(255&p)<<8)>>>1}var g=function(m,R,w){for(var V=m.length,I=0,Z=new d(R);I<V;++I)++Z[m[I]-1];var ie,L=new d(R);for(I=0;I<R;++I)L[I]=L[I-1]+Z[I-1]<<1;if(w){ie=new d(1<<R);var E=15-R;for(I=0;I<V;++I)if(m[I])for(var v=I<<4|m[I],x=R-m[I],U=L[m[I]-1]++<<x,M=U|(1<<x)-1;U<=M;++U)ie[u[U]>>>E]=v}else for(ie=new d(V),I=0;I<V;++I)m[I]&&(ie[I]=u[L[m[I]-1]++]>>>15-m[I]);return ie},y=new r(288);for(c=0;c<144;++c)y[c]=8;for(c=144;c<256;++c)y[c]=9;for(c=256;c<280;++c)y[c]=7;for(c=280;c<288;++c)y[c]=8;var O=new r(32);for(c=0;c<32;++c)O[c]=5;var F=g(y,9,1),k=g(O,5,1),T=function(m){for(var R=m[0],w=1;w<m.length;++w)m[w]>R&&(R=m[w]);return R},S=function(m,R,w){var V=R/8|0;return(m[V]|m[V+1]<<8)>>(7&R)&w},A=function(m,R){var w=R/8|0;return(m[w]|m[w+1]<<8|m[w+2]<<16)>>(7&R)},b=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],D=function(m,R,w){var V=new Error(R||b[m]);if(V.code=m,Error.captureStackTrace&&Error.captureStackTrace(V,D),!w)throw V;return V},N=function(m,R,w){var V=m.length;if(!V||w&&!w.l&&V<5)return R||new r(0);var I=!R||w,Z=!w||w.i;w||(w={}),R||(R=new r(3*V));var ie,L=function(le){var ke=R.length;if(le>ke){var Se=new r(Math.max(2*ke,le));Se.set(R),R=Se}},E=w.f||0,v=w.p||0,x=w.b||0,U=w.l,M=w.d,_=w.m,z=w.n,C=8*V;do{if(!U){w.f=E=S(m,v,1);var P=S(m,v+1,3);if(v+=3,!P){var X=m[(q=((ie=v)/8|0)+(7&ie&&1)+4)-4]|m[q-3]<<8,$=q+X;if($>V){Z&&D(0);break}I&&L(x+X),R.set(m.subarray(q,$),x),w.b=x+=X,w.p=v=8*$;continue}if(P==1)U=F,M=k,_=9,z=5;else if(P==2){var H=S(m,v,31)+257,W=S(m,v+10,15)+4,pe=H+S(m,v+5,31)+1;v+=14;for(var ue=new r(pe),Q=new r(19),ee=0;ee<W;++ee)Q[a[ee]]=S(m,v+3*ee,7);v+=3*W;var se=T(Q),j=(1<<se)-1,te=g(Q,se,1);for(ee=0;ee<pe;){var q,G=te[S(m,v,j)];if(v+=15&G,(q=G>>>4)<16)ue[ee++]=q;else{var he=0,K=0;for(q==16?(K=3+S(m,v,3),v+=2,he=ue[ee-1]):q==17?(K=3+S(m,v,7),v+=3):q==18&&(K=11+S(m,v,127),v+=7);K--;)ue[ee++]=he}}var ne=ue.subarray(0,H),Y=ue.subarray(H);_=T(ne),z=T(Y),U=g(ne,_,1),M=g(Y,z,1)}else D(1);if(v>C){Z&&D(0);break}}I&&L(x+131072);for(var be=(1<<_)-1,re=(1<<z)-1,ae=v;;ae=v){var fe=(he=U[A(m,v)&be])>>>4;if((v+=15&he)>C){Z&&D(0);break}if(he||D(2),fe<256)R[x++]=fe;else{if(fe==256){ae=v,U=null;break}var de=fe-254;if(fe>264){var _e=t[ee=fe-257];de=S(m,v,(1<<_e)-1)+i[ee],v+=_e}var De=M[A(m,v)&re],ge=De>>>4;if(De||D(3),v+=15&De,Y=f[ge],ge>3&&(_e=e[ge],Y+=A(m,v)&(1<<_e)-1,v+=_e),v>C){Z&&D(0);break}I&&L(x+131072);for(var me=x+de;x<me;x+=4)R[x]=R[x-Y],R[x+1]=R[x+1-Y],R[x+2]=R[x+2-Y],R[x+3]=R[x+3-Y];x=me}}w.l=U,w.p=ae,w.b=x,U&&(E=1,w.m=_,w.d=M,w.n=z)}while(!E);return x==R.length?R:function(le,ke,Se){(ke==null||ke<0)&&(ke=0),(Se==null||Se>le.length)&&(Se=le.length);var Oe=new(le instanceof d?d:le instanceof l?l:r)(Se-ke);return Oe.set(le.subarray(ke,Se)),Oe}(R,0,x)},B=new r(0),J=typeof TextDecoder<"u"&&new TextDecoder;try{J.decode(B,{stream:!0})}catch{}return h.convert_streams=function(m){var R=new DataView(m),w=0;function V(){var H=R.getUint16(w);return w+=2,H}function I(){var H=R.getUint32(w);return w+=4,H}function Z(H){X.setUint16($,H),$+=2}function ie(H){X.setUint32($,H),$+=4}for(var L={signature:I(),flavor:I(),length:I(),numTables:V(),reserved:V(),totalSfntSize:I(),majorVersion:V(),minorVersion:V(),metaOffset:I(),metaLength:I(),metaOrigLength:I(),privOffset:I(),privLength:I()},E=0;Math.pow(2,E)<=L.numTables;)E++;E--;for(var v=16*Math.pow(2,E),x=16*L.numTables-v,U=12,M=[],_=0;_<L.numTables;_++)M.push({tag:I(),offset:I(),compLength:I(),origLength:I(),origChecksum:I()}),U+=16;var z,C=new Uint8Array(12+16*M.length+M.reduce(function(H,W){return H+W.origLength+4},0)),P=C.buffer,X=new DataView(P),$=0;return ie(L.flavor),Z(L.numTables),Z(v),Z(E),Z(x),M.forEach(function(H){ie(H.tag),ie(H.origChecksum),ie(U),ie(H.origLength),H.outOffset=U,(U+=H.origLength)%4!=0&&(U+=4-U%4)}),M.forEach(function(H){var W,pe=m.slice(H.offset,H.offset+H.compLength);if(H.compLength!=H.origLength){var ue=new Uint8Array(H.origLength);W=new Uint8Array(pe,2),N(W,ue)}else ue=new Uint8Array(pe);C.set(ue,H.outOffset);var Q=0;(U=H.outOffset+H.origLength)%4!=0&&(Q=4-U%4),C.set(new Uint8Array(Q).buffer,H.outOffset+H.origLength),z=U+Q}),P.slice(0,z)},Object.defineProperty(h,"__esModule",{value:!0}),h}({}).convert_streams}function pa(h,r){let d={M:2,L:2,Q:4,C:6,Z:0},l={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,a=4,o=8,n=16,i=32,s;function f(b){if(!s){let D={R:e,L:t,D:a,C:n,U:i,T:o};s=new Map;for(let N in l){let B=0;l[N].split(",").forEach(J=>{let[m,R]=J.split("+");m=parseInt(m,36),R=R?parseInt(R,36):0,s.set(B+=m,D[N]);for(let w=R;w--;)s.set(++B,D[N])})}}return s.get(b)||i}let u=1,c=2,p=3,g=4,y=[null,"isol","init","fina","medi"];function O(b){let D=new Uint8Array(b.length),N=i,B=u,J=-1;for(let m=0;m<b.length;m++){let R=b.codePointAt(m),w=f(R)|0,V=u;w&o||(N&(t|a|n)?w&(e|a|n)?(V=p,(B===u||B===p)&&D[J]++):w&(t|i)&&(B===c||B===g)&&D[J]--:N&(e|i)&&(B===c||B===g)&&D[J]--,B=D[m]=V,N=w,J=m,R>65535&&m++)}return D}function F(b,D){let N=[];for(let J=0;J<D.length;J++){let m=D.codePointAt(J);m>65535&&J++,N.push(h.U.codeToGlyph(b,m))}let B=b.GSUB;if(B){let{lookupList:J,featureList:m}=B,R,w=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,V=[];m.forEach(I=>{if(w.test(I.tag))for(let Z=0;Z<I.tab.length;Z++){if(V[I.tab[Z]])continue;V[I.tab[Z]]=!0;let ie=J[I.tab[Z]],L=/^(isol|init|fina|medi)$/.test(I.tag);L&&!R&&(R=O(D));for(let E=0;E<N.length;E++)(!R||!L||y[R[E]]===I.tag)&&h.U._applySubs(N,E,ie,J)}})}return N}function k(b,D){let N=new Int16Array(D.length*3),B=0;for(;B<D.length;B++){let w=D[B];if(w===-1)continue;N[B*3+2]=b.hmtx.aWidth[w];let V=b.GPOS;if(V){let I=V.lookupList;for(let Z=0;Z<I.length;Z++){let ie=I[Z];for(let L=0;L<ie.tabs.length;L++){let E=ie.tabs[L];if(ie.ltype===1){if(h._lctf.coverageIndex(E.coverage,w)!==-1&&E.pos){R(E.pos,B);break}}else if(ie.ltype===2){let v=null,x=J();if(x!==-1){let U=h._lctf.coverageIndex(E.coverage,D[x]);if(U!==-1){if(E.fmt===1){let M=E.pairsets[U];for(let _=0;_<M.length;_++)M[_].gid2===w&&(v=M[_])}else if(E.fmt===2){let M=h.U._getGlyphClass(D[x],E.classDef1),_=h.U._getGlyphClass(w,E.classDef2);v=E.matrix[M][_]}if(v){v.val1&&R(v.val1,x),v.val2&&R(v.val2,B);break}}}}else if(ie.ltype===4){let v=h._lctf.coverageIndex(E.markCoverage,w);if(v!==-1){let x=J(m),U=x===-1?-1:h._lctf.coverageIndex(E.baseCoverage,D[x]);if(U!==-1){let M=E.markArray[v],_=E.baseArray[U][M.markClass];N[B*3]=_.x-M.x+N[x*3]-N[x*3+2],N[B*3+1]=_.y-M.y+N[x*3+1];break}}}else if(ie.ltype===6){let v=h._lctf.coverageIndex(E.mark1Coverage,w);if(v!==-1){let x=J();if(x!==-1){let U=D[x];if(T(b,U)===3){let M=h._lctf.coverageIndex(E.mark2Coverage,U);if(M!==-1){let _=E.mark1Array[v],z=E.mark2Array[M][_.markClass];N[B*3]=z.x-_.x+N[x*3]-N[x*3+2],N[B*3+1]=z.y-_.y+N[x*3+1];break}}}}}}}}else if(b.kern&&!b.cff){let I=J();if(I!==-1){let Z=b.kern.glyph1.indexOf(D[I]);if(Z!==-1){let ie=b.kern.rval[Z].glyph2.indexOf(w);ie!==-1&&(N[I*3+2]+=b.kern.rval[Z].vals[ie])}}}}return N;function J(w){for(let V=B-1;V>=0;V--)if(D[V]!==-1&&(!w||w(D[V])))return V;return-1}function m(w){return T(b,w)===1}function R(w,V){for(let I=0;I<3;I++)N[V*3+I]+=w[I]||0}}function T(b,D){let N=b.GDEF&&b.GDEF.glyphClassDef;return N?h.U._getGlyphClass(D,N):0}function S(...b){for(let D=0;D<b.length;D++)if(typeof b[D]=="number")return b[D]}function A(b){let D=Object.create(null),N=b["OS/2"],B=b.hhea,J=b.head.unitsPerEm,m=S(N&&N.sTypoAscender,B&&B.ascender,J),R={unitsPerEm:J,ascender:m,descender:S(N&&N.sTypoDescender,B&&B.descender,0),capHeight:S(N&&N.sCapHeight,m),xHeight:S(N&&N.sxHeight,m),lineGap:S(N&&N.sTypoLineGap,B&&B.lineGap),supportsCodePoint(w){return h.U.codeToGlyph(b,w)>0},forEachGlyph(w,V,I,Z){let ie=0,L=1/R.unitsPerEm*V,E=F(b,w),v=0,x=k(b,E);return E.forEach((U,M)=>{if(U!==-1){let _=D[U];if(!_){let{cmds:z,crds:C}=h.U.glyphToPath(b,U),P="",X=0;for(let ue=0,Q=z.length;ue<Q;ue++){let ee=d[z[ue]];P+=z[ue];for(let se=1;se<=ee;se++)P+=(se>1?",":"")+C[X++]}let $,H,W,pe;if(C.length){$=H=1/0,W=pe=-1/0;for(let ue=0,Q=C.length;ue<Q;ue+=2){let ee=C[ue],se=C[ue+1];ee<$&&($=ee),se<H&&(H=se),ee>W&&(W=ee),se>pe&&(pe=se)}}else $=W=H=pe=0;_=D[U]={index:U,advanceWidth:b.hmtx.aWidth[U],xMin:$,yMin:H,xMax:W,yMax:pe,path:P}}Z.call(null,_,ie+x[M*3]*L,x[M*3+1]*L,v),ie+=x[M*3+2]*L,I&&(ie+=I*V)}v+=w.codePointAt(v)>65535?2:1}),ie}};return R}return function(D){let N=new Uint8Array(D,0,4),B=h._bin.readASCII(N,0,4);if(B==="wOFF")D=r(D);else if(B==="wOF2")throw new Error("woff2 fonts not supported");return A(h.parse(D)[0])}}var ga=$e({name:"Typr Font Parser",dependencies:[da,va,pa],init(h,r,d){let l=h(),t=r();return d(l,t)}});function ma(){return function(h){var r=function(){this.buckets=new Map};r.prototype.add=function(k){var T=k>>5;this.buckets.set(T,(this.buckets.get(T)||0)|1<<(31&k))},r.prototype.has=function(k){var T=this.buckets.get(k>>5);return T!==void 0&&(T&1<<(31&k))!=0},r.prototype.serialize=function(){var k=[];return this.buckets.forEach(function(T,S){k.push((+S).toString(36)+":"+T.toString(36))}),k.join(",")},r.prototype.deserialize=function(k){var T=this;this.buckets.clear(),k.split(",").forEach(function(S){var A=S.split(":");T.buckets.set(parseInt(A[0],36),parseInt(A[1],36))})};var d=Math.pow(2,8),l=d-1,t=~l;function e(k){var T=function(A){return A&t}(k).toString(16),S=function(A){return(A&t)+d-1}(k).toString(16);return"codepoint-index/plane"+(k>>16)+"/"+T+"-"+S+".json"}function a(k,T){var S=k&l,A=T.codePointAt(S/6|0);return((A=(A||48)-48)&1<<S%6)!=0}function o(k,T){var S;(S=k,S.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(A){return A.split("-").map(function(b){return parseInt(b.trim(),16)})})).forEach(function(A){var b=A[0],D=A[1];D===void 0&&(D=b),T(b,D)})}function n(k,T){o(k,function(S,A){for(var b=S;b<=A;b++)T(b)})}var i={},s={},f=new WeakMap,u="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function c(k){var T=f.get(k);return T||(T=new r,n(k.ranges,function(S){return T.add(S)}),f.set(k,T)),T}var p,g=new Map;function y(k,T,S){return k[T]?T:k[S]?S:function(A){for(var b in A)return b}(k)}function O(k,T){var S=T;if(!k.includes(S)){S=1/0;for(var A=0;A<k.length;A++)Math.abs(k[A]-T)<Math.abs(S-T)&&(S=k[A])}return S}function F(k){return p||(p=new Set,n("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(T){p.add(T)})),p.has(k)}return h.CodePointSet=r,h.clearCache=function(){i={},s={}},h.getFontsForString=function(k,T){T===void 0&&(T={});var S,A=T.lang;A===void 0&&(A=/\p{Script=Hangul}/u.test(S=k)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(S)?"ja":"en");var b=T.category;b===void 0&&(b="sans-serif");var D=T.style;D===void 0&&(D="normal");var N=T.weight;N===void 0&&(N=400);var B=(T.dataUrl||u).replace(/\/$/g,""),J=new Map,m=new Uint8Array(k.length),R={},w={},V=new Array(k.length),I=new Map,Z=!1;function ie(v){var x=g.get(v);return x||(x=fetch(B+"/"+v).then(function(U){if(!U.ok)throw new Error(U.statusText);return U.json().then(function(M){if(!Array.isArray(M)||M[0]!==1)throw new Error("Incorrect schema version; need 1, got "+M[0]);return M[1]})}).catch(function(U){if(B!==u)return Z||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+B+'", trying default CDN. '+U.message),Z=!0),B=u,g.delete(v),ie(v);throw U}),g.set(v,x)),x}for(var L=function(v){var x=k.codePointAt(v),U=e(x);V[v]=U,i[U]||I.has(U)||I.set(U,ie(U).then(function(M){i[U]=M})),x>65535&&(v++,E=v)},E=0;E<k.length;E++)L(E);return Promise.all(I.values()).then(function(){I.clear();for(var v=function(U){var M=k.codePointAt(U),_=null,z=i[V[U]],C=void 0;for(var P in z){var X=w[P];if(X===void 0&&(X=w[P]=new RegExp(P).test(A||"en")),X){for(var $ in C=P,z[P])if(a(M,z[P][$])){_=$;break}break}}if(!_){e:for(var H in z)if(H!==C){for(var W in z[H])if(a(M,z[H][W])){_=W;break e}}}_||(console.debug("No font coverage for U+"+M.toString(16)),_="latin"),V[U]=_,s[_]||I.has(_)||I.set(_,ie("font-meta/"+_+".json").then(function(pe){s[_]=pe})),M>65535&&(U++,x=U)},x=0;x<k.length;x++)v(x);return Promise.all(I.values())}).then(function(){for(var v,x=null,U=0;U<k.length;U++){var M=k.codePointAt(U);if(x&&(F(M)||c(x).has(M)))m[U]=m[U-1];else{x=s[V[U]];var _=R[x.id];if(!_){var z=x.typeforms,C=y(z,b,"sans-serif"),P=y(z[C],D,"normal"),X=O((v=z[C])===null||v===void 0?void 0:v[P],N);_=R[x.id]=B+"/font-files/"+x.id+"/"+C+"."+P+"."+X+".woff"}var $=J.get(_);$==null&&($=J.size,J.set(_,$)),m[U]=$}M>65535&&(U++,m[U]=m[U-1])}return{fontUrls:Array.from(J.keys()),chars:m}})},Object.defineProperty(h,"__esModule",{value:!0}),h}({})}function ya(h,r){let d=Object.create(null),l=Object.create(null);function t(a,o){let n=i=>{console.error(`Failure loading font ${a}`,i)};try{let i=new XMLHttpRequest;i.open("get",a,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status>=400)n(new Error(i.statusText));else if(i.status>0)try{let s=h(i.response);s.src=a,o(s)}catch(s){n(s)}},i.onerror=n,i.send()}catch(i){n(i)}}function e(a,o){let n=d[a];n?o(n):l[a]?l[a].push(o):(l[a]=[o],t(a,i=>{i.src=a,d[a]=i,l[a].forEach(s=>s(i)),delete l[a]}))}return function(a,o,{lang:n,fonts:i=[],style:s="normal",weight:f="normal",unicodeFontsURL:u}={}){let c=new Uint8Array(a.length),p=[];a.length||F();let g=new Map,y=[];if(s!=="italic"&&(s="normal"),typeof f!="number"&&(f=f==="bold"?700:400),i&&!Array.isArray(i)&&(i=[i]),i=i.slice().filter(T=>!T.lang||T.lang.test(n)).reverse(),i.length){let b=0;(function D(N=0){for(let B=N,J=a.length;B<J;B++){let m=a.codePointAt(B);if(b===1&&p[c[B-1]].supportsCodePoint(m)||B>0&&/\s/.test(a[B]))c[B]=c[B-1],b===2&&(y[y.length-1][1]=B);else for(let R=c[B],w=i.length;R<=w;R++)if(R===w){let V=b===2?y[y.length-1]:y[y.length]=[B,B];V[1]=B,b=2}else{c[B]=R;let{src:V,unicodeRange:I}=i[R];if(!I||k(m,I)){let Z=d[V];if(!Z){e(V,()=>{D(B)});return}if(Z.supportsCodePoint(m)){let ie=g.get(Z);typeof ie!="number"&&(ie=p.length,p.push(Z),g.set(Z,ie)),c[B]=ie,b=1;break}}}m>65535&&B+1<J&&(c[B+1]=c[B],B++,b===2&&(y[y.length-1][1]=B))}O()})()}else y.push([0,a.length-1]),O();function O(){if(y.length){let T=y.map(S=>a.substring(S[0],S[1]+1)).join(`
`);r.getFontsForString(T,{lang:n||void 0,style:s,weight:f,dataUrl:u}).then(({fontUrls:S,chars:A})=>{let b=p.length,D=0;y.forEach(B=>{for(let J=0,m=B[1]-B[0];J<=m;J++)c[B[0]+J]=A[D++]+b;D++});let N=0;S.forEach((B,J)=>{e(B,m=>{p[J+b]=m,++N===S.length&&F()})})})}else F()}function F(){o({chars:c,fonts:p})}function k(T,S){for(let A=0;A<S.length;A++){let[b,D=b]=S[A];if(b<=T&&T<=D)return!0}return!1}}}var ba=$e({name:"FontResolver",dependencies:[ya,ga,ma],init(h,r,d){return h(r,d())}});function xa(h,r){let l=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,t="[^\\S\\u00A0]",e=new RegExp(`${t}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:p,lang:g,fonts:y,style:O,weight:F,preResolvedFonts:k,unicodeFontsURL:T},S){let A=({chars:b,fonts:D})=>{let N,B,J=[];for(let m=0;m<b.length;m++)b[m]!==B?(B=b[m],J.push(N={start:m,end:m,fontObj:D[b[m]]})):N.end=m;S(J)};k?A(k):h(p,A,{lang:g,fonts:y,style:O,weight:F,unicodeFontsURL:T})}function o({text:p="",font:g,lang:y,sdfGlyphSize:O=64,fontSize:F=400,fontWeight:k=1,fontStyle:T="normal",letterSpacing:S=0,lineHeight:A="normal",maxWidth:b=1/0,direction:D,textAlign:N="left",textIndent:B=0,whiteSpace:J="normal",overflowWrap:m="normal",anchorX:R=0,anchorY:w=0,metricsOnly:V=!1,unicodeFontsURL:I,preResolvedFonts:Z=null,includeCaretPositions:ie=!1,chunkedBoundsSize:L=8192,colorRanges:E=null},v){let x=f(),U={fontLoad:0,typesetting:0};p.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),p=p.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),F=+F,S=+S,b=+b,A=A||"normal",B=+B,a({text:p,lang:y,style:T,weight:k,fonts:typeof g=="string"?[{src:g}]:g,unicodeFontsURL:I,preResolvedFonts:Z},M=>{U.fontLoad=f()-x;let _=isFinite(b),z=null,C=null,P=null,X=null,$=null,H=null,W=null,pe=null,ue=0,Q=0,ee=J!=="nowrap",se=new Map,j=f(),te=B,q=0,G=new u,he=[G];M.forEach(re=>{let{fontObj:ae}=re,{ascender:fe,descender:de,unitsPerEm:_e,lineGap:De,capHeight:ge,xHeight:me}=ae,le=se.get(ae);if(!le){let ce=F/_e,xe=A==="normal"?(fe-de+De)*ce:A*F,He=(xe-(fe-de)*ce)/2,Te=Math.min(xe,(fe-de)*ce),ye=(fe+de)/2*ce+Te/2;le={index:se.size,src:ae.src,fontObj:ae,fontSizeMult:ce,unitsPerEm:_e,ascender:fe*ce,descender:de*ce,capHeight:ge*ce,xHeight:me*ce,lineHeight:xe,baseline:-He-fe*ce,caretTop:ye,caretBottom:ye-Te},se.set(ae,le)}let{fontSizeMult:ke}=le,Se=p.slice(re.start,re.end+1),Oe,Ue;ae.forEachGlyph(Se,F,S,(ce,xe,He,Te)=>{xe+=q,Te+=re.start,Oe=xe,Ue=ce;let ye=p.charAt(Te),Me=ce.advanceWidth*ke,we=G.count,ve;if("isEmpty"in ce||(ce.isWhitespace=!!ye&&new RegExp(t).test(ye),ce.canBreakAfter=!!ye&&e.test(ye),ce.isEmpty=ce.xMin===ce.xMax||ce.yMin===ce.yMax||l.test(ye)),!ce.isWhitespace&&!ce.isEmpty&&Q++,ee&&_&&!ce.isWhitespace&&xe+Me+te>b&&we){if(G.glyphAt(we-1).glyphObj.canBreakAfter)ve=new u,te=-xe;else for(let Be=we;Be--;)if(Be===0&&m==="break-word"){ve=new u,te=-xe;break}else if(G.glyphAt(Be).glyphObj.canBreakAfter){ve=G.splitAt(Be+1);let Ee=ve.glyphAt(0).x;te-=Ee;for(let Ae=ve.count;Ae--;)ve.glyphAt(Ae).x-=Ee;break}ve&&(G.isSoftWrapped=!0,G=ve,he.push(G),ue=b)}let Fe=G.glyphAt(G.count);Fe.glyphObj=ce,Fe.x=xe+te,Fe.y=He,Fe.width=Me,Fe.charIndex=Te,Fe.fontData=le,ye===`
`&&(G=new u,he.push(G),te=-(xe+Me+S*F)+B)}),q=Oe+Ue.advanceWidth*ke+S*F});let K=0;he.forEach(re=>{let ae=!0;for(let fe=re.count;fe--;){let de=re.glyphAt(fe);ae&&!de.glyphObj.isWhitespace&&(re.width=de.x+de.width,re.width>ue&&(ue=re.width),ae=!1);let{lineHeight:_e,capHeight:De,xHeight:ge,baseline:me}=de.fontData;_e>re.lineHeight&&(re.lineHeight=_e);let le=me-re.baseline;le<0&&(re.baseline+=le,re.cap+=le,re.ex+=le),re.cap=Math.max(re.cap,re.baseline+De),re.ex=Math.max(re.ex,re.baseline+ge)}re.baseline-=K,re.cap-=K,re.ex-=K,K+=re.lineHeight});let ne=0,Y=0;if(R&&(typeof R=="number"?ne=-R:typeof R=="string"&&(ne=-ue*(R==="left"?0:R==="center"?.5:R==="right"?1:i(R)))),w&&(typeof w=="number"?Y=-w:typeof w=="string"&&(Y=w==="top"?0:w==="top-baseline"?-he[0].baseline:w==="top-cap"?-he[0].cap:w==="top-ex"?-he[0].ex:w==="middle"?K/2:w==="bottom"?K:w==="bottom-baseline"?-he[he.length-1].baseline:i(w)*K)),!V){let re=r.getEmbeddingLevels(p,D);z=new Uint16Array(Q),C=new Uint8Array(Q),P=new Float32Array(Q*2),X={},W=[1/0,1/0,-1/0,-1/0],pe=[],ie&&(H=new Float32Array(p.length*4)),E&&($=new Uint8Array(Q*3));let ae=0,fe=-1,de=-1,_e,De;if(he.forEach((ge,me)=>{let{count:le,width:ke}=ge;if(le>0){let Se=0;for(let Te=le;Te--&&ge.glyphAt(Te).glyphObj.isWhitespace;)Se++;let Oe=0,Ue=0;if(N==="center")Oe=(ue-ke)/2;else if(N==="right")Oe=ue-ke;else if(N==="justify"&&ge.isSoftWrapped){let Te=0;for(let ye=le-Se;ye--;)ge.glyphAt(ye).glyphObj.isWhitespace&&Te++;Ue=(ue-ke)/Te}if(Ue||Oe){let Te=0;for(let ye=0;ye<le;ye++){let Me=ge.glyphAt(ye),we=Me.glyphObj;Me.x+=Oe+Te,Ue!==0&&we.isWhitespace&&ye<le-Se&&(Te+=Ue,Me.width+=Ue)}}let ce=r.getReorderSegments(p,re,ge.glyphAt(0).charIndex,ge.glyphAt(ge.count-1).charIndex);for(let Te=0;Te<ce.length;Te++){let[ye,Me]=ce[Te],we=1/0,ve=-1/0;for(let Fe=0;Fe<le;Fe++)if(ge.glyphAt(Fe).charIndex>=ye){let Be=Fe,Ee=Fe;for(;Ee<le;Ee++){let Ae=ge.glyphAt(Ee);if(Ae.charIndex>Me)break;Ee<le-Se&&(we=Math.min(we,Ae.x),ve=Math.max(ve,Ae.x+Ae.width))}for(let Ae=Be;Ae<Ee;Ae++){let Ie=ge.glyphAt(Ae);Ie.x=ve-(Ie.x+Ie.width-we)}break}}let xe,He=Te=>xe=Te;for(let Te=0;Te<le;Te++){let ye=ge.glyphAt(Te);xe=ye.glyphObj;let Me=xe.index,we=re.levels[ye.charIndex]&1;if(we){let ve=r.getMirroredCharacter(p[ye.charIndex]);ve&&ye.fontData.fontObj.forEachGlyph(ve,0,0,He)}if(ie){let{charIndex:ve,fontData:Fe}=ye,Be=ye.x+ne,Ee=ye.x+ye.width+ne;H[ve*4]=we?Ee:Be,H[ve*4+1]=we?Be:Ee,H[ve*4+2]=ge.baseline+Fe.caretBottom+Y,H[ve*4+3]=ge.baseline+Fe.caretTop+Y;let Ae=ve-fe;Ae>1&&s(H,fe,Ae),fe=ve}if(E){let{charIndex:ve}=ye;for(;ve>de;)de++,E.hasOwnProperty(de)&&(De=E[de])}if(!xe.isWhitespace&&!xe.isEmpty){let ve=ae++,{fontSizeMult:Fe,src:Be,index:Ee}=ye.fontData,Ae=X[Be]||(X[Be]={});Ae[Me]||(Ae[Me]={path:xe.path,pathBounds:[xe.xMin,xe.yMin,xe.xMax,xe.yMax]});let Ie=ye.x+ne,Xe=ye.y+ge.baseline+Y;P[ve*2]=Ie,P[ve*2+1]=Xe;let Ve=Ie+xe.xMin*Fe,Ye=Xe+xe.yMin*Fe,Ze=Ie+xe.xMax*Fe,je=Xe+xe.yMax*Fe;Ve<W[0]&&(W[0]=Ve),Ye<W[1]&&(W[1]=Ye),Ze>W[2]&&(W[2]=Ze),je>W[3]&&(W[3]=je),ve%L===0&&(_e={start:ve,end:ve,rect:[1/0,1/0,-1/0,-1/0]},pe.push(_e)),_e.end++;let Re=_e.rect;if(Ve<Re[0]&&(Re[0]=Ve),Ye<Re[1]&&(Re[1]=Ye),Ze>Re[2]&&(Re[2]=Ze),je>Re[3]&&(Re[3]=je),z[ve]=Me,C[ve]=Ee,E){let qe=ve*3;$[qe]=De>>16&255,$[qe+1]=De>>8&255,$[qe+2]=De&255}}}}}),H){let ge=p.length-fe;ge>1&&s(H,fe,ge)}}let be=[];se.forEach(({index:re,src:ae,unitsPerEm:fe,ascender:de,descender:_e,lineHeight:De,capHeight:ge,xHeight:me})=>{be[re]={src:ae,unitsPerEm:fe,ascender:de,descender:_e,lineHeight:De,capHeight:ge,xHeight:me}}),U.typesetting=f()-j,v({glyphIds:z,glyphFontIndices:C,glyphPositions:P,glyphData:X,fontData:be,caretPositions:H,glyphColors:$,chunkedBounds:pe,fontSize:F,topBaseline:Y+he[0].baseline,blockBounds:[ne,Y-K,ne+ue,Y],visibleBounds:W,timings:U})})}function n(p,g){o({...p,metricsOnly:!0},y=>{let[O,F,k,T]=y.blockBounds;g({width:k-O,height:T-F})})}function i(p){let g=p.match(/^([\d.]+)%$/),y=g?parseFloat(g[1]):NaN;return isNaN(y)?0:y/100}function s(p,g,y){let O=p[g*4],F=p[g*4+1],k=p[g*4+2],T=p[g*4+3],S=(F-O)/y;for(let A=0;A<y;A++){let b=(g+A)*4;p[b]=O+S*A,p[b+1]=O+S*(A+1),p[b+2]=k,p[b+3]=T}}function f(){return(self.performance||Date).now()}function u(){this.data=[]}let c=["glyphObj","x","y","width","charIndex","fontData"];return u.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/c.length)},glyphAt(p){let g=u.flyweight;return g.data=this.data,g.index=p,g},splitAt(p){let g=new u;return g.data=this.data.splice(p*c.length),g}},u.flyweight=c.reduce((p,g,y,O)=>(Object.defineProperty(p,g,{get(){return this.data[this.index*c.length+y]},set(F){this.data[this.index*c.length+y]=F}}),p),{data:null,index:0}),{typeset:o,measure:n}}var tt=()=>(self.performance||Date).now(),Ht=vr(),on;function Ta(h,r,d,l,t,e,a,o,n,i,s=!0){return s?Ua(h,r,d,l,t,e,a,o,n,i).then(null,f=>(on||(console.warn("WebGL SDF generation failed, falling back to JS",f),on=!0),ln(h,r,d,l,t,e,a,o,n,i))):ln(h,r,d,l,t,e,a,o,n,i)}var Nt=[],_a=5,xr=0;function xn(){let h=tt();for(;Nt.length&&tt()-h<_a;)Nt.shift()();xr=Nt.length?setTimeout(xn,0):0}var Ua=(...h)=>new Promise((r,d)=>{Nt.push(()=>{let l=tt();try{Ht.webgl.generateIntoCanvas(...h),r({timing:tt()-l})}catch(t){d(t)}}),xr||(xr=setTimeout(xn,0))}),ka=4,Sa=2e3,sn={},wa=0;function ln(h,r,d,l,t,e,a,o,n,i){let s="TroikaTextSDFGenerator_JS_"+wa++%ka,f=sn[s];return f||(f=sn[s]={workerModule:$e({name:s,workerId:s,dependencies:[vr,tt],init(u,c){let p=u().javascript.generate;return function(...g){let y=c();return{textureData:p(...g),timing:c()-y}}},getTransferables(u){return[u.textureData.buffer]}}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(h,r,d,l,t,e).then(({textureData:u,timing:c})=>{let p=tt(),g=new Uint8Array(u.length*4);for(let y=0;y<u.length;y++)g[y*4+i]=u[y];return Ht.webglUtils.renderImageData(a,g,o,n,h,r,1<<3-i),c+=tt()-p,--f.requests===0&&(f.idleTimer=setTimeout(()=>{Zr(s)},Sa)),{timing:c}})}function Fa(h){h._warm||(Ht.webgl.isSupported(h),h._warm=!0)}var Da=Ht.webglUtils.resizeWebGLCanvasWithoutClearing,Qe={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048,useWorker:!0},Ma=new jt,Tn=!1;function st(){return(self.performance||Date).now()}function ho(h){Tn?console.warn("configureTextBuilder called after first font request; will be ignored."):kn(Qe,h)}var Vt=Object.create(null);function _n(h,r){Tn=!0,h=kn({},h);let d=st(),{defaultFontURL:l}=Qe,t=[];if(l&&t.push({label:"default",src:fn(l)}),h.font&&t.push({label:"user",src:fn(h.font)}),h.font=t,h.text=""+h.text,h.sdfGlyphSize=h.sdfGlyphSize||Qe.sdfGlyphSize,h.unicodeFontsURL=h.unicodeFontsURL||Qe.unicodeFontsURL,h.colorRanges!=null){let c={};for(let p in h.colorRanges)if(h.colorRanges.hasOwnProperty(p)){let g=h.colorRanges[p];typeof g!="number"&&(g=Ma.set(g).getHex()),c[p]=g}h.colorRanges=c}Object.freeze(h);let{textureWidth:e,sdfExponent:a}=Qe,{sdfGlyphSize:o}=h,n=e/o*4,i=Vt[o];if(!i){let c=document.createElement("canvas");c.width=e,c.height=o*256/n,i=Vt[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:c,sdfTexture:new ta(c,void 0,void 0,void 0,nn,nn),contextLost:!1,glyphsByFont:new Map},i.sdfTexture.generateMipmaps=!1,Aa(i)}let{sdfTexture:s,sdfCanvas:f}=i;(Qe.useWorker?wn:Ea)(h).then(c=>{let{glyphIds:p,glyphFontIndices:g,fontData:y,glyphPositions:O,fontSize:F,timings:k}=c,T=[],S=new Float32Array(p.length*4),A=0,b=0,D=st(),N=y.map(w=>{let V=i.glyphsByFont.get(w.src);return V||i.glyphsByFont.set(w.src,V=new Map),V});p.forEach((w,V)=>{let I=g[V],{src:Z,unitsPerEm:ie}=y[I],L=N[I].get(w);if(!L){let{path:M,pathBounds:_}=c.glyphData[Z][w],z=Math.max(_[2]-_[0],_[3]-_[1])/o*(Qe.sdfMargin*o+.5),C=i.glyphCount++,P=[_[0]-z,_[1]-z,_[2]+z,_[3]+z];N[I].set(w,L={path:M,atlasIndex:C,sdfViewBox:P}),T.push(L)}let{sdfViewBox:E}=L,v=O[b++],x=O[b++],U=F/ie;S[A++]=v+E[0]*U,S[A++]=x+E[1]*U,S[A++]=v+E[2]*U,S[A++]=x+E[3]*U,p[V]=L.atlasIndex}),k.quads=(k.quads||0)+(st()-D);let B=st();k.sdf={};let J=f.height,m=Math.ceil(i.glyphCount/n),R=Math.pow(2,Math.ceil(Math.log2(m*o)));R>J&&(console.info(`Increasing SDF texture size ${J}->${R}`),Da(f,e,R),s.dispose()),Promise.all(T.map(w=>Un(w,i,h.gpuAccelerateSDF).then(({timing:V})=>{k.sdf[w.atlasIndex]=V}))).then(()=>{T.length&&!i.contextLost&&(Sn(i),s.needsUpdate=!0),k.sdfTotal=st()-B,k.total=st()-d,r(Object.freeze({parameters:h,sdfTexture:s,sdfGlyphSize:o,sdfExponent:a,glyphBounds:S,glyphAtlasIndices:p,glyphColors:c.glyphColors,caretPositions:c.caretPositions,chunkedBounds:c.chunkedBounds,ascender:c.ascender,descender:c.descender,lineHeight:c.lineHeight,capHeight:c.capHeight,xHeight:c.xHeight,topBaseline:c.topBaseline,blockBounds:c.blockBounds,visibleBounds:c.visibleBounds,timings:c.timings}))})}),Promise.resolve().then(()=>{i.contextLost||Fa(f)})}function Un({path:h,atlasIndex:r,sdfViewBox:d},{sdfGlyphSize:l,sdfCanvas:t,contextLost:e},a){if(e)return Promise.resolve({timing:-1});let{textureWidth:o,sdfExponent:n}=Qe,i=Math.max(d[2]-d[0],d[3]-d[1]),s=Math.floor(r/4),f=s%(o/l)*l,u=Math.floor(s/(o/l))*l,c=r%4;return Ta(l,l,h,d,i,n,t,f,u,c,a)}function Aa(h){let r=h.sdfCanvas;r.addEventListener("webglcontextlost",d=>{console.log("Context Lost",d),d.preventDefault(),h.contextLost=!0}),r.addEventListener("webglcontextrestored",d=>{console.log("Context Restored",d),h.contextLost=!1;let l=[];h.glyphsByFont.forEach(t=>{t.forEach(e=>{l.push(Un(e,h,!0))})}),Promise.all(l).then(()=>{Sn(h),h.sdfTexture.needsUpdate=!0})})}function vo({font:h,characters:r,sdfGlyphSize:d},l){let t=Array.isArray(r)?r.join(`
`):""+r;_n({font:h,sdfGlyphSize:d,text:t},l)}function kn(h,r){for(let d in r)r.hasOwnProperty(d)&&(h[d]=r[d]);return h}var It;function fn(h){return It||(It=typeof document>"u"?{}:document.createElement("a")),It.href=h,It.href}function Sn(h){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");let{sdfCanvas:r,sdfTexture:d}=h,{width:l,height:t}=r,e=h.sdfCanvas.getContext("webgl"),a=d.image.data;(!a||a.length!==l*t*4)&&(a=new Uint8Array(l*t*4),d.image={width:l,height:t,data:a},d.flipY=!1,d.isDataTexture=!0),e.readPixels(0,0,l,t,e.RGBA,e.UNSIGNED_BYTE,a)}}var Ca=$e({name:"Typesetter",dependencies:[xa,ba,qr],init(h,r,d){return h(r,d())}}),wn=$e({name:"Typesetter",dependencies:[Ca],init(h){return function(r){return new Promise(d=>{h.typeset(r,d)})}},getTransferables(h){let r=[];for(let d in h)h[d]&&h[d].buffer&&r.push(h[d].buffer);return r}}),Ea=wn.onMainThread;function po(){Object.keys(Vt).forEach(h=>{let r=Vt[h].sdfCanvas,{width:d,height:l}=r;console.log("%c.",`
      background: url(${r.toDataURL()});
      background-size: ${d}px ${l}px;
      color: transparent;
      font-size: 0;
      line-height: ${l}px;
      padding-left: ${d}px;
    `)})}var un={};function Ba(h){let r=un[h];return r||(r=un[h]=new Ur(1,1,h,h).translate(.5,.5,0)),r}var Wt="aTroikaGlyphBounds",Ut="aTroikaGlyphIndex",Ra="aTroikaGlyphColor",Tr=class extends ra{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new na,this.boundingBox=new bn}computeBoundingSphere(){}computeBoundingBox(){}set detail(r){if(r!==this._detail){this._detail=r,(typeof r!="number"||r<1)&&(r=1);let d=Ba(r);["position","normal","uv"].forEach(l=>{this.attributes[l]=d.attributes[l].clone()}),this.setIndex(d.getIndex().clone())}}get detail(){return this._detail}set curveRadius(r){r!==this._curveRadius&&(this._curveRadius=r,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(r,d,l,t,e){this.updateAttributeData(Wt,r,4),this.updateAttributeData(Ut,d,1),this.updateAttributeData(Ra,e,3),this._blockBounds=l,this._chunkedBounds=t,this.instanceCount=d.length,this._updateBounds()}_updateBounds(){let r=this._blockBounds;if(r){let{curveRadius:d,boundingBox:l}=this;if(d){let{PI:t,floor:e,min:a,max:o,sin:n,cos:i}=Math,s=t/2,f=t*2,u=Math.abs(d),c=r[0]/u,p=r[2]/u,g=e((c+s)/f)!==e((p+s)/f)?-u:a(n(c)*u,n(p)*u),y=e((c-s)/f)!==e((p-s)/f)?u:o(n(c)*u,n(p)*u),O=e((c+t)/f)!==e((p+t)/f)?u*2:o(u-i(c)*u,u-i(p)*u);l.min.set(g,r[1],d<0?-O:0),l.max.set(y,r[3],d<0?0:O)}else l.min.set(r[0],r[1],0),l.max.set(r[2],r[3],0);l.getBoundingSphere(this.boundingSphere)}}applyClipRect(r){let d=this.getAttribute(Ut).count,l=this._chunkedBounds;if(l)for(let t=l.length;t--;){d=l[t].end;let e=l[t].rect;if(e[1]<r.w&&e[3]>r.y&&e[0]<r.z&&e[2]>r.x)break}this.instanceCount=d}updateAttributeData(r,d,l){let t=this.getAttribute(r);d?t&&t.array.length===d.length?(t.array.set(d),t.needsUpdate=!0):(this.setAttribute(r,new aa(d,l)),delete this._maxInstanceCount,this.dispose()):t&&this.deleteAttribute(r)}},Oa=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,Ga=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}

position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,La=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator

  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {

  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);

  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 :
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);



  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,Pa=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Fn(h){let r=it(h,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new kt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new an(0,0,0,0)},uTroikaClipRect:{value:new an(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new kt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new jt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new oa},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Oa,vertexTransform:Ga,fragmentDefs:La,fragmentColorTransform:Pa,customRewriter({vertexShader:d,fragmentShader:l}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(l)&&(l=l.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(d)||(d=d.replace(gr,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:d,fragmentShader:l}}});return r.transparent=!0,r.forceSinglePass=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),r}var wr=new ia({color:16777215,side:sa,transparent:!0}),cn=8421504,hn=new la,zt=new Sr,mr=new Sr,_t=[],Ia=new Sr,yr="+x+y";function dn(h){return Array.isArray(h)?h[0]:h}var Dn=()=>{let h=new kr(new Ur(1,1),wr);return Dn=()=>h,h},Mn=()=>{let h=new kr(new Ur(1,1,32,1),wr);return Mn=()=>h,h},za={type:"syncstart"},Na={type:"synccomplete"},An=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Wa=An.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail"),ft=class extends kr{constructor(){let r=new Tr;super(r,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=cn,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=yr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(r){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(r):(this._isSyncing=!0,this.dispatchEvent(za),_n({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},d=>{this._isSyncing=!1,this._textRenderInfo=d,this.geometry.updateGlyphs(d.glyphBounds,d.glyphAtlasIndices,d.blockBounds,d.chunkedBounds,d.glyphColors);let l=this._queuedSyncs;l&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{l.forEach(t=>t&&t())})),this.dispatchEvent(Na),r&&r()})))}onBeforeRender(r,d,l,t,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(r){return Fn(r)}get material(){let r=this._derivedMaterial,d=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=wr.clone());if((!r||!r.isDerivedFrom(d))&&(r=this._derivedMaterial=this.createDerivedMaterial(d),d.addEventListener("dispose",function l(){d.removeEventListener("dispose",l),r.dispose()})),this.hasOutline()){let l=r._outlineMtl;return l||(l=r._outlineMtl=Object.create(r,{id:{value:r.id+.1}}),l.isTextOutlineMaterial=!0,l.depthWrite=!1,l.map=null,r.addEventListener("dispose",function t(){r.removeEventListener("dispose",t),l.dispose()})),[l,r]}else return r}set material(r){r&&r.isTroikaTextMaterial?(this._derivedMaterial=r,this._baseMaterial=r.baseMaterial):this._baseMaterial=r}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(r){this.geometry.detail=r}get curveRadius(){return this.geometry.curveRadius}set curveRadius(r){this.geometry.curveRadius=r}get customDepthMaterial(){return dn(this.material).getDepthMaterial()}set customDepthMaterial(r){}get customDistanceMaterial(){return dn(this.material).getDistanceMaterial()}set customDistanceMaterial(r){}_prepareForRender(r){let d=r.isTextOutlineMaterial,l=r.uniforms,t=this.textRenderInfo;if(t){let{sdfTexture:o,blockBounds:n}=t;l.uTroikaSDFTexture.value=o,l.uTroikaSDFTextureSize.value.set(o.image.width,o.image.height),l.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,l.uTroikaSDFExponent.value=t.sdfExponent,l.uTroikaTotalBounds.value.fromArray(n),l.uTroikaUseGlyphColors.value=!d&&!!t.glyphColors;let i=0,s=0,f=0,u,c,p,g=0,y=0;if(d){let{outlineWidth:F,outlineOffsetX:k,outlineOffsetY:T,outlineBlur:S,outlineOpacity:A}=this;i=this._parsePercent(F)||0,s=Math.max(0,this._parsePercent(S)||0),u=A,g=this._parsePercent(k)||0,y=this._parsePercent(T)||0}else f=Math.max(0,this._parsePercent(this.strokeWidth)||0),f&&(p=this.strokeColor,l.uTroikaStrokeColor.value.set(p??cn),c=this.strokeOpacity,c==null&&(c=1)),u=this.fillOpacity;l.uTroikaEdgeOffset.value=i,l.uTroikaPositionOffset.value.set(g,y),l.uTroikaBlurRadius.value=s,l.uTroikaStrokeWidth.value=f,l.uTroikaStrokeOpacity.value=c,l.uTroikaFillOpacity.value=u??1,l.uTroikaCurveRadius.value=this.curveRadius||0;let O=this.clipRect;if(O&&Array.isArray(O)&&O.length===4)l.uTroikaClipRect.value.fromArray(O);else{let F=(this.fontSize||.1)*100;l.uTroikaClipRect.value.set(n[0]-F,n[1]-F,n[2]+F,n[3]+F)}this.geometry.applyClipRect(l.uTroikaClipRect.value)}l.uTroikaSDFDebug.value=!!this.debugSDF,r.polygonOffset=!!this.depthOffset,r.polygonOffsetFactor=r.polygonOffsetUnits=this.depthOffset||0;let e=d?this.outlineColor||0:this.color;if(e==null)delete r.color;else{let o=r.hasOwnProperty("color")?r.color:r.color=new jt;(e!==o._input||typeof e=="object")&&o.set(o._input=e)}let a=this.orientation||yr;if(a!==r._orientation){let o=l.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let n=a!==yr&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,i,s,f,u]=n;zt.set(0,0,0)[s]=i==="-"?1:-1,mr.set(0,0,0)[u]=f==="-"?-1:1,hn.lookAt(Ia,zt.cross(mr),mr),o.setFromMatrix4(hn)}else o.identity();r._orientation=a}}_parsePercent(r){if(typeof r=="string"){let d=r.match(/^(-?[\d.]+)%$/),l=d?parseFloat(d[1]):NaN;r=(isNaN(l)?0:l/100)*this.fontSize}return r}localPositionToTextCoords(r,d=new kt){d.copy(r);let l=this.curveRadius;return l&&(d.x=Math.atan2(r.x,Math.abs(l)-Math.abs(r.z))*Math.abs(l)),d}worldPositionToTextCoords(r,d=new kt){return zt.copy(r),this.localPositionToTextCoords(this.worldToLocal(zt),d)}raycast(r,d){let{textRenderInfo:l,curveRadius:t}=this;if(l){let e=l.blockBounds,a=t?Mn():Dn(),o=a.geometry,{position:n,uv:i}=o.attributes;for(let s=0;s<i.count;s++){let f=e[0]+i.getX(s)*(e[2]-e[0]),u=e[1]+i.getY(s)*(e[3]-e[1]),c=0;t&&(c=t-Math.cos(f/t)*t,f=Math.sin(f/t)*t),n.setXYZ(s,f,u,c)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,_t.length=0,a.raycast(r,_t);for(let s=0;s<_t.length;s++)_t[s].object=this,d.push(_t[s])}}copy(r){let d=this.geometry;return super.copy(r),this.geometry=d,Wa.forEach(l=>{this[l]=r[l]}),this}clone(){return new this.constructor().copy(this)}};An.forEach(h=>{let r="_private_"+h;Object.defineProperty(ft.prototype,h,{get(){return this[r]},set(d){d!==this[r]&&(this[r]=d,this._needsSync=!0)}})});var Va={type:"syncstart"},ja={type:"synccomplete"},lt="aTroikaTextBatchMemberIndex",_r=32,vn=new bn,pn=new jt,gn=class h extends ft{constructor(){super(),this._members=new Map,this._dataTextures={},this._onMemberSynced=r=>{this._members.get(r.target).dirty=!0}}add(...r){for(let d=0;d<r.length;d++)r[d]instanceof ft?this.addText(r[d]):super.add(r[d]);return this}remove(...r){for(let d=0;d<r.length;d++)r[d]instanceof ft?this.removeText(r[d]):super.remove(r[d]);return this}addText(r){this._members.has(r)||(this._members.set(r,{index:-1,glyphCount:-1,dirty:!0}),r.addEventListener("synccomplete",this._onMemberSynced))}removeText(r){this._needsRepack=!0,r.removeEventListener("synccomplete",this._onMemberSynced),this._members.delete(r)}createDerivedMaterial(r){return Ha(r)}updateMatrixWorld(r){super.updateMatrixWorld(r),this.updateBounds()}updateBounds(){let r=this.geometry.boundingBox.makeEmpty();this._members.forEach((d,l)=>{l.matrixAutoUpdate&&l.updateMatrix(),vn.copy(l.geometry.boundingBox).applyMatrix4(l.matrix),r.union(vn)}),r.getBoundingSphere(this.geometry.boundingSphere)}hasOutline(){for(let r of this._members.keys())if(r.hasOutline())return!0;return!1}_prepareForRender(r){let d=r.isTextOutlineMaterial;r.uniforms.uTroikaIsOutline.value=d;let l=this._dataTextures[d?"outline":"main"],t=Math.pow(2,Math.ceil(Math.log2(this._members.size*_r)));if(!l||t!==l.image.data.length){l&&l.dispose();let o=Math.min(t/4,1024);l=this._dataTextures[d?"outline":"main"]=new fa(new Float32Array(t),o,t/4/o,ua,ca)}let e=l.image.data,a=(o,n)=>{n!==e[o]&&(e[o]=n,l.needsUpdate=!0)};this._members.forEach(({index:o,dirty:n},i)=>{if(o>-1){let s=o*_r,f=i.matrix.elements;for(let b=0;b<16;b++)a(s+b,f[b]);i._prepareForRender(r);let{uTroikaTotalBounds:u,uTroikaClipRect:c,uTroikaPositionOffset:p,uTroikaEdgeOffset:g,uTroikaBlurRadius:y,uTroikaStrokeWidth:O,uTroikaStrokeColor:F,uTroikaStrokeOpacity:k,uTroikaFillOpacity:T,uTroikaCurveRadius:S}=r.uniforms;for(let b=0;b<4;b++)a(s+16+b,u.value.getComponent(b));for(let b=0;b<4;b++)a(s+20+b,c.value.getComponent(b));let A=d?i.outlineColor||0:i.color;A==null&&(A=this.color),A==null&&(A=this.material.color),A==null&&(A=16777215),a(s+24,pn.set(A).getHex()),a(s+25,T.value),a(s+26,S.value),d?(a(s+28,p.value.x),a(s+29,p.value.y),a(s+30,g.value),a(s+31,y.value)):(a(s+28,O.value),a(s+29,pn.set(F.value).getHex()),a(s+30,k.value))}}),r.setMatrixTexture(l),super._prepareForRender(r)}sync(r){let d=this._needsRepack?[]:null;this._needsRepack=!1,this._members.forEach((l,t)=>{(l.dirty||t._needsSync)&&(l.dirty=!1,(d||(d=[])).push(new Promise(e=>{t._needsSync?t.sync(e):e()})))}),d&&(this.dispatchEvent(Va),Promise.all(d).then(()=>{let{geometry:l}=this,t=l.attributes,e=t[lt]&&t[lt].array||new Uint16Array(0),a=t[Ut]&&t[Ut].array||new Float32Array(0),o=t[Wt]&&t[Wt].array||new Float32Array(0),n=0;this._members.forEach((f,{textRenderInfo:u})=>{u&&(n+=u.glyphAtlasIndices.length,this._textRenderInfo=u)}),n!==e.length&&(e=br(e,n),a=br(a,n),o=br(o,n*4));let i=0,s=0;this._members.forEach((f,{textRenderInfo:u})=>{if(u){let c=u.glyphAtlasIndices.length;e.fill(i,s,s+c),a.set(u.glyphAtlasIndices,s,s+c),o.set(u.glyphBounds,s*4,(s+c)*4),s+=c,f.index=i++}}),l.updateAttributeData(lt,e,1),l.getAttribute(lt).setUsage(ha),l.updateAttributeData(Ut,a,1),l.updateAttributeData(Wt,o,4),this.updateBounds(),this.dispatchEvent(ja),r&&r()}))}copy(r){return r instanceof h&&(super.copy(r),this._members.forEach((d,l)=>this.removeText(l)),r._members.forEach((d,l)=>this.addText(l))),this}dispose(){super.dispose(),Object.values(this._dataTextures).forEach(r=>r.dispose())}};function br(h,r){let d=new h.constructor(r);return d.set(h.subarray(0,r)),d}function Ha(h){let r="uTroikaMatricesTexture",d="uTroikaMatricesTextureSize",l=it(h,{chained:!0,uniforms:{[d]:{value:new kt},[r]:{value:null}},vertexDefs:`
      uniform highp sampler2D ${r};
      uniform vec2 ${d};
      attribute float ${lt};

      vec4 troikaBatchTexel(float offset) {
        offset += ${lt} * ${_r.toFixed(1)} / 4.0;
        float w = ${d}.x;
        vec2 uv = (vec2(mod(offset, w), floor(offset / w)) + 0.5) / ${d};
        return texture2D(${r}, uv);
      }
    `,vertexTransform:`
      mat4 matrix = mat4(
        troikaBatchTexel(0.0),
        troikaBatchTexel(1.0),
        troikaBatchTexel(2.0),
        troikaBatchTexel(3.0)
      );
      position.xyz = (matrix * vec4(position, 1.0)).xyz;
    `});return l=Fn(l),l=it(l,{chained:!0,uniforms:{uTroikaIsOutline:{value:!1}},customRewriter(t){return["uTroikaTotalBounds","uTroikaClipRect","uTroikaPositionOffset","uTroikaEdgeOffset","uTroikaBlurRadius","uTroikaStrokeWidth","uTroikaStrokeColor","uTroikaStrokeOpacity","uTroikaFillOpacity","uTroikaCurveRadius","diffuse"].forEach(a=>{t=Xa(t,a)}),t},vertexDefs:`
      uniform bool uTroikaIsOutline;
      vec3 troikaFloatToColor(float v) {
        return mod(floor(vec3(v / 65536.0, v / 256.0, v)), 256.0) / 256.0;
      }
    `,vertexTransform:`
      uTroikaTotalBounds = troikaBatchTexel(4.0);
      uTroikaClipRect = troikaBatchTexel(5.0);

      vec4 data = troikaBatchTexel(6.0);
      diffuse = troikaFloatToColor(data.x);
      uTroikaFillOpacity = data.y;
      uTroikaCurveRadius = data.z;

      data = troikaBatchTexel(7.0);
      if (uTroikaIsOutline) {
        if (data == vec4(0.0)) { // degenerate if zero outline
          position = vec3(0.0);
        } else {
          uTroikaPositionOffset = data.xy;
          uTroikaEdgeOffset = data.z;
          uTroikaBlurRadius = data.w;
        }
      } else {
        uTroikaStrokeWidth = data.x;
        uTroikaStrokeColor = troikaFloatToColor(data.y);
        uTroikaStrokeOpacity = data.z;
      }
    `}),l.setMatrixTexture=t=>{l.uniforms[r].value=t,l.uniforms[d].value.set(t.image.width,t.image.height)},l}function Xa({vertexShader:h,fragmentShader:r},d,l=d){let t=new RegExp(`uniform\\s+(bool|float|vec[234]|mat[34])\\s+${d}\\b`),e,a=!1;r=r.replace(t,(n,i)=>(a=!0,`varying ${e=i} ${l}`));let o=!1;return h=h.replace(t,(n,i)=>(o=!0,`${a?"varying":""} ${e=i} ${l}`)),o||(h=`${a?"varying":""} ${e} ${l};
${h}`),{vertexShader:h,fragmentShader:r}}function go(h,r,d){let l=null,t=Ya(h),e=null;return t.forEach(a=>{(!e||Math.abs(d-(a.top+a.bottom)/2)<Math.abs(d-(e.top+e.bottom)/2))&&(e=a)}),e.carets.forEach(a=>{(!l||Math.abs(r-a.x)<Math.abs(r-l.x))&&(l=a)}),l}var mn=new WeakMap;function mo(h,r,d){let l;if(h){let t=mn.get(h);if(t&&t.start===r&&t.end===d)return t.rects;let{caretPositions:e}=h;if(d<r){let o=r;r=d,d=o}r=Math.max(r,0),d=Math.min(d,e.length+1),l=[];let a=null;for(let o=r;o<d;o++){let n=e[o*4],i=e[o*4+1],s=Math.min(n,i),f=Math.max(n,i),u=e[o*4+2],c=e[o*4+3];(!a||u!==a.bottom||c!==a.top||s>a.right||f<a.left)&&(a={left:1/0,right:-1/0,bottom:u,top:c},l.push(a)),a.left=Math.min(s,a.left),a.right=Math.max(f,a.right)}l.sort((o,n)=>n.bottom-o.bottom||o.left-n.left);for(let o=l.length-1;o-- >0;){let n=l[o],i=l[o+1];n.bottom===i.bottom&&n.top===i.top&&n.left<=i.right&&n.right>=i.left&&(i.left=Math.min(i.left,n.left),i.right=Math.max(i.right,n.right),l.splice(o,1))}mn.set(h,{start:r,end:d,rects:l})}return l}var yn=new WeakMap;function Ya(h){let r=yn.get(h);if(!r){r=[];let{caretPositions:d}=h,l,t=(a,o,n,i)=>{(!l||n<(l.top+l.bottom)/2)&&r.push(l={bottom:o,top:n,carets:[]}),n>l.top&&(l.top=n),o<l.bottom&&(l.bottom=o),l.carets.push({x:a,y:o,height:n-o,charIndex:i})},e=0;for(;e<d.length;e+=4)t(d[e],d[e+2],d[e+3],e/4);t(d[e-3],d[e-2],d[e-1],e/4)}return yn.set(h,r),r}export{gn as BatchedText,Tr as GlyphsGeometry,ft as Text,ho as configureTextBuilder,Fn as createTextDerivedMaterial,po as dumpSDFTextures,ba as fontResolverWorkerModule,go as getCaretAtPoint,mo as getSelectionRects,_n as getTextRenderInfo,vo as preloadFont,Ca as typesetterWorkerModule};
/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/
/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering.
Original licenses apply:
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/
/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering.
Original MIT license applies
*/
